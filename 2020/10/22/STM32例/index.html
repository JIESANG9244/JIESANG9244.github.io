<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="JieSang" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="JieSang" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="JieSang" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.3"><link rel="canonical" href="http://example.com/2020/10/22/STM32%E4%BE%8B/"><title>STM32例 | Dioy = JieSang</title><meta name="generator" content="Hexo 5.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">STM32例</h1><div class="meta"><span class="item" title="创建时间：2020-10-22 16:11:08"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2020-10-22T16:11:08+08:00">2020-10-22</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Dioy</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giciryrr3rj20zk0m8nhk.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicljgocqbj20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicli3sbvtj20zk0m8x6p.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipet4bz0yj20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclfb3vzhj20zk0m8wny.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclimtf7dj20zk0m8qav.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main id="main"><div class="inner"><div id="content" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/2020/10/22/STM32%E4%BE%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/1.jpg"><meta itemprop="name" content="Do"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="JieSang"></span><div class="body md" itemprop="articleBody"><h2 id="野火stm32f1系列开发板学习案例"><a class="anchor" href="#野火stm32f1系列开发板学习案例">#</a> 野火 STM32F1 系列开发板学习案例</h2><ol><li>野火 F1 开发板 STM32-USART 使用 2020-10-02</li><li>野火 F1 开发板 STM32 案例 - 外部中断 (按键) 使用 2020-10-03</li><li>更新....</li></ol><p>#####################################################################</p><h1 id="野火f1开发板stm32-usart使用"><a class="anchor" href="#野火f1开发板stm32-usart使用">#</a> 野火 F1 开发板 STM32-USART 使用</h1><h2 id="硬件平台"><a class="anchor" href="#硬件平台">#</a> 硬件平台</h2><ol><li>野火 STM32F103ZET6 霸道 V2 开发板</li><li>正点原子 F1 开发板</li><li>STM32 蓝色板<br><img data-src="https://img-blog.csdnimg.cn/20201002210908329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt="野火STM32产品"></li></ol><h2 id="软件平台"><a class="anchor" href="#软件平台">#</a> 软件平台</h2><ol><li>Keil MDK 5.31</li><li>串口调试助手</li></ol><h2 id="串口配置步骤"><a class="anchor" href="#串口配置步骤">#</a> 串口配置步骤</h2><ol><li>使能 RX 和 TX 引脚 GPIO 时钟和 USART 时钟；</li><li>初始化 GPIO，并将 GPIO 复用到 USART. 上；</li><li>配置 USART 参数；</li><li>配置中断控制器并使能 USART 接收中断；</li><li>使 能 USART；</li><li>在 USART 接收中断服务函数实现数据接收和发送。</li></ol><h2 id="工程模板结构"><a class="anchor" href="#工程模板结构">#</a> 工程模板结构</h2><p><img data-src="https://img-blog.csdnimg.cn/20201002204307734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt="工程模板结构"><br>文件夹 STExtend 外设扩展文件，USER 用户自定义函数库<br>工程文件下载链接<span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC5jc2RuLm5ldC9kb3dubG9hZC93ZWl4aW5fNDM1OTkzOTAvMTI5MDk5MDE="> https://download.csdn.net/download/weixin_43599390/12909901</span></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//bsp_xx.h 板载第三方库文件</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32f10x.h"</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_led.h"</span>  </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_key.h"</span> </span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_beep.h"</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_exit.h"</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"timer.h"</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_ili9341_lcd.h"</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_SysTick.h"</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_usart.h"</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_test.h"</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"STM32F103xxxx_USART.H"</span></span></pre></td></tr></table></figure><h2 id="stm32f103zet6-串口引脚列表"><a class="anchor" href="#stm32f103zet6-串口引脚列表">#</a> STM32F103ZET6 串口引脚列表</h2><p><img data-src="https://img-blog.csdnimg.cn/20201002205012211.png#pic_center" alt="串口引脚列表"></p><h3 id="stm32f103xxxx_usartc"><a class="anchor" href="#stm32f103xxxx_usartc">#</a> STM32F103xxxx_USART.C</h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//==================================================================================================                                  // 包含全局头文件</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"STM32F103xxxx_USART.H"</span>                     <span class="token comment">// 包含内设头文件 USART-USART 通信总线</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//  宏自定义声明    |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">//  定义引用变量    |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">//  硬件端口定义    |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">//  引用函数声明    |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_Configure</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Char<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">USART_ReceiveChar</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendString</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendArray</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>Array<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendLine</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendNumber_SignedInteger</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">signed</span> <span class="token keyword">short</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendNumber_UnsignedInteger</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendNumber_Float</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">float</span> Number<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment">//  函数功能: USART 发送字节</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">//  函数标记：内设驱动函数</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">//  函数说明：本函数没有考虑发送 9 位数据可能性</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment">//  输入参量: USARTx - 通道号  取值范围 - USARTx1/USARTx2/USARTx3/UARTx4/UARTx5</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment">//            Byte - 字节  取值范文 - ASCII 字符</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment">//  输出参量：无</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment">//  |   -   |   -   |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Char<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>USARTx <span class="token operator">-></span> SR <span class="token operator">&amp;</span> <span class="token number">0x40</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// 等待上次发送完成   </span></pre></td></tr><tr><td data-num="43"></td><td><pre>    USARTx <span class="token operator">-></span> DR <span class="token operator">=</span> Char<span class="token punctuation">;</span>                            <span class="token comment">// 装载本次发送数据    </span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token comment">//  函数功能: USART 接收字符</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token comment">//  函数标记：内设驱动函数</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token comment">//  函数说明: </span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token comment">//  输入参量: USARTx - 通道号  取值范围 - USARTx1/USARTx2/USARTx3/UARTx4/UARTx5</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token comment">//  输出参量: Char - 待接收字节  取值范围 - ASCII 字符</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token comment">//  |   -   |   -   |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">USART_ReceiveChar</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token keyword">return</span> USARTx<span class="token operator">-></span>DR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token comment">//  函数功能: USART 发送字符串</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token comment">//  函数标记：内设驱动函数</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token comment">//  函数说明：无</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token comment">//  输入参量: USARTx - 通道号  取值范围 - USARTx1/USARTx2/USARTx3/UARTx4/UARTx5</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token comment">//            String - 待发送字符串指针  取值范文 - ASCII 字符串</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token comment">//  输出参量：无</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token comment">//  |   -   |   -   |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendString</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>String<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>String <span class="token operator">!=</span> <span class="token string">'\0'</span><span class="token punctuation">)</span>                          <span class="token comment">// \0 表示字符串结束标志，通过检测是否字符串末尾</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span> <span class="token operator">*</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        String<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="80"></td><td><pre></pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token comment">//  函数功能: USART 发送数组</span></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token comment">//  函数标记：内设驱动函数</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token comment">//  函数说明：无</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token comment">//  输入参量: USARTx - 通道号  取值范围 - USARTx1/USARTx2/USARTx3/UARTx4/UARTx5</span></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token comment">//            Array - 待发送数组的指针  取值范围 - 指针类型</span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token comment">//            Count - 待发送数组的数量  取值范围 - 0~255</span></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token comment">//  输出参量：无</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token comment">//  |   -   |   -   |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendArray</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>Array<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                            <span class="token comment">// 定义局部变量 用于函数循环</span></pre></td></tr><tr><td data-num="96"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>Count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="97"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>        <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span> Array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </pre></td></tr><tr><td data-num="99"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="101"></td><td><pre></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token comment">//  函数功能: USART 发送回车换行</span></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token comment">//  函数标记：内设驱动函数</span></pre></td></tr><tr><td data-num="105"></td><td><pre><span class="token comment">//  函数说明：无</span></pre></td></tr><tr><td data-num="106"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token comment">//  输入参量: USARTx - 通道号  取值范围 - USARTx1/USARTx2/USARTx3/UARTx4/UARTx5</span></pre></td></tr><tr><td data-num="108"></td><td><pre><span class="token comment">//  输出参量：无</span></pre></td></tr><tr><td data-num="109"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="110"></td><td><pre><span class="token comment">//  |   -   |   -   |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="111"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="112"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendLine</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="113"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>    <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span> <span class="token number">0x0D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// 换行</span></pre></td></tr><tr><td data-num="115"></td><td><pre>    <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span> <span class="token number">0x0A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// 回车</span></pre></td></tr><tr><td data-num="116"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="117"></td><td><pre></pre></td></tr><tr><td data-num="118"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="119"></td><td><pre><span class="token comment">//  函数功能: USART 发送有符号整型数字</span></pre></td></tr><tr><td data-num="120"></td><td><pre><span class="token comment">//  函数标记：内设驱动函数</span></pre></td></tr><tr><td data-num="121"></td><td><pre><span class="token comment">//  函数说明：无</span></pre></td></tr><tr><td data-num="122"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="123"></td><td><pre><span class="token comment">//  输入参量: USARTx - 通道号  取值范围 - USARTx1/USARTx2/USARTx3/UARTx4/UARTx5</span></pre></td></tr><tr><td data-num="124"></td><td><pre><span class="token comment">//            Number - 待发送整数  取值范围 - 整型类型 -99999~+99999</span></pre></td></tr><tr><td data-num="125"></td><td><pre><span class="token comment">//            Count - 显示的位数  取值范围 - 1~5</span></pre></td></tr><tr><td data-num="126"></td><td><pre><span class="token comment">//  输出参量：无</span></pre></td></tr><tr><td data-num="127"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="128"></td><td><pre><span class="token comment">//  |   -   |   -   |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="129"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="130"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendNumber_SignedInteger</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">signed</span> <span class="token keyword">short</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="131"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> NumberArray<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>             <span class="token comment">// 定义局部数组，用于数据存储</span></pre></td></tr><tr><td data-num="133"></td><td><pre>    </pre></td></tr><tr><td data-num="134"></td><td><pre>    <span class="token comment">// 判断 整型数字正负</span></pre></td></tr><tr><td data-num="135"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Number<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="136"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="137"></td><td><pre>        Number <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">-</span> Number<span class="token punctuation">;</span>                        <span class="token comment">// 负数转整数</span></pre></td></tr><tr><td data-num="138"></td><td><pre>        <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>    <span class="token keyword">else</span></pre></td></tr><tr><td data-num="141"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="142"></td><td><pre>        <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="143"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="144"></td><td><pre>        </pre></td></tr><tr><td data-num="145"></td><td><pre>    <span class="token comment">// 计算各位数值的字符</span></pre></td></tr><tr><td data-num="146"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count<span class="token operator">></span><span class="token number">4</span><span class="token punctuation">)</span> NumberArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="147"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count<span class="token operator">></span><span class="token number">3</span><span class="token punctuation">)</span> NumberArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token number">1000</span> <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="148"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count<span class="token operator">></span><span class="token number">2</span><span class="token punctuation">)</span> NumberArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token number">100</span>  <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="149"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count<span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span> NumberArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token number">10</span>   <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="150"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> NumberArray<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token number">1</span>    <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="151"></td><td><pre>   </pre></td></tr><tr><td data-num="152"></td><td><pre>    <span class="token comment">// 发送串口数据</span></pre></td></tr><tr><td data-num="153"></td><td><pre>    <span class="token function">USART_SendArray</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span><span class="token operator">&amp;</span>NumberArray<span class="token punctuation">[</span><span class="token number">5</span><span class="token operator">-</span>Count<span class="token punctuation">]</span><span class="token punctuation">,</span>Count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="155"></td><td><pre></pre></td></tr><tr><td data-num="156"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="157"></td><td><pre><span class="token comment">//  函数功能: USART 发送无符号整型数字</span></pre></td></tr><tr><td data-num="158"></td><td><pre><span class="token comment">//  函数标记：内设驱动函数</span></pre></td></tr><tr><td data-num="159"></td><td><pre><span class="token comment">//  函数说明：无</span></pre></td></tr><tr><td data-num="160"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="161"></td><td><pre><span class="token comment">//  输入参量: USARTx - 通道号  取值范围 - USARTx1/USARTx2/USARTx3/UARTx4/UARTx5</span></pre></td></tr><tr><td data-num="162"></td><td><pre><span class="token comment">//            Number - 待发送整数  取值范围 - 整型类型 0~99999</span></pre></td></tr><tr><td data-num="163"></td><td><pre><span class="token comment">//            Count - 显示的位数  取值范围 - 1~5</span></pre></td></tr><tr><td data-num="164"></td><td><pre><span class="token comment">//  输出参量：无</span></pre></td></tr><tr><td data-num="165"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="166"></td><td><pre><span class="token comment">//  |   -   |   -   |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="167"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="168"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendNumber_UnsignedInteger</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="169"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="170"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> NumberArray<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>             <span class="token comment">// 定义局部数组，用于数据存储</span></pre></td></tr><tr><td data-num="171"></td><td><pre>    </pre></td></tr><tr><td data-num="172"></td><td><pre>    <span class="token comment">// 断言检查参数</span></pre></td></tr><tr><td data-num="173"></td><td><pre>    </pre></td></tr><tr><td data-num="174"></td><td><pre>    </pre></td></tr><tr><td data-num="175"></td><td><pre>    <span class="token comment">// 执行相关操作</span></pre></td></tr><tr><td data-num="176"></td><td><pre>    <span class="token comment">// 计算各位数值的字符</span></pre></td></tr><tr><td data-num="177"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count<span class="token operator">></span><span class="token number">4</span><span class="token punctuation">)</span> NumberArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="178"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count<span class="token operator">></span><span class="token number">3</span><span class="token punctuation">)</span> NumberArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token number">1000</span> <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="179"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count<span class="token operator">></span><span class="token number">2</span><span class="token punctuation">)</span> NumberArray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token number">100</span>  <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="180"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count<span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span> NumberArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token number">10</span>   <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="181"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> NumberArray<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token number">1</span>    <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="182"></td><td><pre>    </pre></td></tr><tr><td data-num="183"></td><td><pre>    <span class="token comment">// 发送串口数据</span></pre></td></tr><tr><td data-num="184"></td><td><pre>    <span class="token function">USART_SendArray</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span><span class="token operator">&amp;</span>NumberArray<span class="token punctuation">[</span><span class="token number">5</span><span class="token operator">-</span>Count<span class="token punctuation">]</span><span class="token punctuation">,</span>Count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="185"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="186"></td><td><pre></pre></td></tr><tr><td data-num="187"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="188"></td><td><pre><span class="token comment">//  函数功能: USART 发送数字 浮点类型</span></pre></td></tr><tr><td data-num="189"></td><td><pre><span class="token comment">//  函数标记：内设驱动函数</span></pre></td></tr><tr><td data-num="190"></td><td><pre><span class="token comment">//  函数说明：本函数打印浮点数字与实际输入数字存在偏差</span></pre></td></tr><tr><td data-num="191"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="192"></td><td><pre><span class="token comment">//  输入参量: USARTx - 通道号  取值范围 - USARTx1/USARTx2/USARTx3/UARTx4/UARTx5</span></pre></td></tr><tr><td data-num="193"></td><td><pre><span class="token comment">//            Number - 待发送浮点型数字  取值范围 - -99999.99999~99999.99999</span></pre></td></tr><tr><td data-num="194"></td><td><pre><span class="token comment">//            Count1 - 整数显示位数  取值范围 - 0~5</span></pre></td></tr><tr><td data-num="195"></td><td><pre><span class="token comment">//            Count2 - 小数显示位数  取值范围 - 0~5</span></pre></td></tr><tr><td data-num="196"></td><td><pre><span class="token comment">//  输出参量：无</span></pre></td></tr><tr><td data-num="197"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="198"></td><td><pre><span class="token comment">//  |   -   |   -   |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="199"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="200"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendNumber_Float</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">float</span> Number<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="201"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="202"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Number_Integer_Array<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token comment">// 定义局部数组 用于存储整数位各位数据</span></pre></td></tr><tr><td data-num="203"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Number_Decimal_Array<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          <span class="token comment">// 定义局部数组 用于存储小数位各位数据</span></pre></td></tr><tr><td data-num="204"></td><td><pre></pre></td></tr><tr><td data-num="205"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span>  Number_Integer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>          <span class="token comment">// 定义局部变量 表示浮点数的整数部分</span></pre></td></tr><tr><td data-num="206"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span>  Number_Decimal <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>          <span class="token comment">// 定义局部变量 表示浮点数的小数部分</span></pre></td></tr><tr><td data-num="207"></td><td><pre></pre></td></tr><tr><td data-num="208"></td><td><pre>    <span class="token comment">// 判断 浮点数字正负</span></pre></td></tr><tr><td data-num="209"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Number <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="210"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="211"></td><td><pre>        Number <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">-</span> Number<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="212"></td><td><pre>        <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="213"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="214"></td><td><pre>    <span class="token keyword">else</span></pre></td></tr><tr><td data-num="215"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="216"></td><td><pre>        <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="217"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="218"></td><td><pre>    </pre></td></tr><tr><td data-num="219"></td><td><pre>    <span class="token comment">// 限制 发送位数</span></pre></td></tr><tr><td data-num="220"></td><td><pre>    <span class="token comment">// 由于由于 float 型的有效十进制数值最多为 7 位，即整数位 + 小数位 数量一定小于等于 7</span></pre></td></tr><tr><td data-num="221"></td><td><pre>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Count1 <span class="token operator">+</span> Count2 <span class="token operator">></span> <span class="token number">7</span> <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="222"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="223"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Count1 <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>Count1 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="224"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="225"></td><td><pre>            <span class="token operator">--</span>Count1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="226"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="227"></td><td><pre>        <span class="token keyword">else</span></pre></td></tr><tr><td data-num="228"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="229"></td><td><pre>            <span class="token operator">--</span>Count2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="230"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="231"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="232"></td><td><pre>    </pre></td></tr><tr><td data-num="233"></td><td><pre>    <span class="token comment">// 分离 整数位与小数位</span></pre></td></tr><tr><td data-num="234"></td><td><pre>    <span class="token comment">// 取整数部分</span></pre></td></tr><tr><td data-num="235"></td><td><pre>    Number_Integer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Number<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="236"></td><td><pre>    <span class="token comment">// 取小数部分 1e5 科学计数法表示 10000</span></pre></td></tr><tr><td data-num="237"></td><td><pre>    Number_Decimal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Number <span class="token operator">-</span> Number_Integer <span class="token operator">+</span> <span class="token number">0.000005</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1e5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="238"></td><td><pre>        </pre></td></tr><tr><td data-num="239"></td><td><pre>    <span class="token comment">// 计算各位数值的字符</span></pre></td></tr><tr><td data-num="240"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count1<span class="token operator">></span><span class="token number">4</span><span class="token punctuation">)</span> Number_Integer_Array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number_Integer<span class="token operator">/</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="241"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count1<span class="token operator">></span><span class="token number">3</span><span class="token punctuation">)</span> Number_Integer_Array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number_Integer<span class="token operator">/</span><span class="token number">1000</span> <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="242"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count1<span class="token operator">></span><span class="token number">2</span><span class="token punctuation">)</span> Number_Integer_Array<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number_Integer<span class="token operator">/</span><span class="token number">100</span>  <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="243"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count1<span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span> Number_Integer_Array<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number_Integer<span class="token operator">/</span><span class="token number">10</span>   <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="244"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count1<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> Number_Integer_Array<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number_Integer<span class="token operator">/</span><span class="token number">1</span>    <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="245"></td><td><pre>    </pre></td></tr><tr><td data-num="246"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count2<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> Number_Decimal_Array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number_Decimal<span class="token operator">/</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="247"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count2<span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span> Number_Decimal_Array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number_Decimal<span class="token operator">/</span><span class="token number">1000</span> <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="248"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count2<span class="token operator">></span><span class="token number">2</span><span class="token punctuation">)</span> Number_Decimal_Array<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number_Decimal<span class="token operator">/</span><span class="token number">100</span>  <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="249"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count2<span class="token operator">></span><span class="token number">3</span><span class="token punctuation">)</span> Number_Decimal_Array<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number_Decimal<span class="token operator">/</span><span class="token number">10</span>   <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="250"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>Count2<span class="token operator">></span><span class="token number">4</span><span class="token punctuation">)</span> Number_Decimal_Array<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>Number_Decimal<span class="token operator">/</span><span class="token number">1</span>    <span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">0x30</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="251"></td><td><pre>   </pre></td></tr><tr><td data-num="252"></td><td><pre>    <span class="token function">USART_SendArray</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Number_Integer_Array<span class="token punctuation">[</span><span class="token number">5</span><span class="token operator">-</span>Count1<span class="token punctuation">]</span><span class="token punctuation">,</span> Count1<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 显示整数位</span></pre></td></tr><tr><td data-num="253"></td><td><pre>    <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="254"></td><td><pre>    <span class="token function">USART_SendArray</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Number_Decimal_Array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        Count2<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 显示小数位</span></pre></td></tr><tr><td data-num="255"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="256"></td><td><pre></pre></td></tr><tr><td data-num="257"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="258"></td><td><pre><span class="token comment">//  函数功能: USART 发送数字 二进制数字</span></pre></td></tr><tr><td data-num="259"></td><td><pre><span class="token comment">//  函数标记：内设驱动函数</span></pre></td></tr><tr><td data-num="260"></td><td><pre><span class="token comment">//  函数说明：无</span></pre></td></tr><tr><td data-num="261"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="262"></td><td><pre><span class="token comment">//  输入参量: USARTx - 通道号  取值范围 - USARTx1/USARTx2/USARTx3/UARTx4/UARTx5</span></pre></td></tr><tr><td data-num="263"></td><td><pre><span class="token comment">//            Number - 待发送有符号长整型数字  取值范围 - -99999.99999~99999.99999</span></pre></td></tr><tr><td data-num="264"></td><td><pre><span class="token comment">//            Count - 整数显示位数  取值范围 - 0~5</span></pre></td></tr><tr><td data-num="265"></td><td><pre><span class="token comment">//  输出参量：无</span></pre></td></tr><tr><td data-num="266"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="267"></td><td><pre><span class="token comment">//  |   -   |   -   |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="268"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="269"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendNumber_Binary</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span><span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="270"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="271"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="272"></td><td><pre>    </pre></td></tr><tr><td data-num="273"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Count<span class="token punctuation">;</span> i<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="274"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="275"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>Number <span class="token operator">&amp;</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>Count<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="276"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="277"></td><td><pre>            <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="278"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="279"></td><td><pre>        <span class="token keyword">else</span></pre></td></tr><tr><td data-num="280"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="281"></td><td><pre>            <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USARTx<span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="282"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="283"></td><td><pre>        Number <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="284"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="285"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="286"></td><td><pre></pre></td></tr><tr><td data-num="287"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="288"></td><td><pre><span class="token comment">//  函数功能: USART 预配置</span></pre></td></tr><tr><td data-num="289"></td><td><pre><span class="token comment">//  函数标记：内设驱动函数</span></pre></td></tr><tr><td data-num="290"></td><td><pre><span class="token comment">//  函数说明：无</span></pre></td></tr><tr><td data-num="291"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="292"></td><td><pre><span class="token comment">//  输入参量：无</span></pre></td></tr><tr><td data-num="293"></td><td><pre><span class="token comment">//  输出参量：无</span></pre></td></tr><tr><td data-num="294"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="295"></td><td><pre><span class="token comment">//  |   -   |   -   |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9</span></pre></td></tr><tr><td data-num="296"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="297"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_Configure</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="298"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="299"></td><td><pre>  </pre></td></tr><tr><td data-num="300"></td><td><pre>    USART_InitTypeDef USART_InitStructure_USARTx1<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="301"></td><td><pre>    <span class="token comment">//----------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="302"></td><td><pre>    <span class="token comment">// 配置 USARTx1 功能</span></pre></td></tr><tr><td data-num="303"></td><td><pre>    <span class="token comment">//----------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="304"></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx1 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="305"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="306"></td><td><pre>        <span class="token comment">// 参数检查</span></pre></td></tr><tr><td data-num="307"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_BAUD <span class="token operator">!=</span> <span class="token number">600</span><span class="token punctuation">)</span>   </span><span class="token punctuation">\</span></span></pre></td></tr><tr><td data-num="308"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx1_BAUD <span class="token operator">!=</span> <span class="token number">1200</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="309"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx1_BAUD <span class="token operator">!=</span> <span class="token number">2400</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="310"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx1_BAUD <span class="token operator">!=</span> <span class="token number">4800</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="311"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx1_BAUD <span class="token operator">!=</span> <span class="token number">9600</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="312"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx1_BAUD <span class="token operator">!=</span> <span class="token number">14400</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="313"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx1_BAUD <span class="token operator">!=</span> <span class="token number">19200</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="314"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx1_BAUD <span class="token operator">!=</span> <span class="token number">38400</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="315"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx1_BAUD <span class="token operator">!=</span> <span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></pre></td></tr><tr><td data-num="316"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="317"></td><td><pre>            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token string">"There are errors in the STM32F103xxxx_USARTx1_BAUD"</span></span></pre></td></tr><tr><td data-num="318"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="319"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if ((STM32F103xxxx_USARTx1_BAUD != 600)   \</span></span></pre></td></tr><tr><td data-num="320"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx1_BAUD != 1200)  \</pre></td></tr><tr><td data-num="321"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx1_BAUD != 2400)  \</pre></td></tr><tr><td data-num="322"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx1_BAUD != 4800)  \</pre></td></tr><tr><td data-num="323"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx1_BAUD != 9600)  \</pre></td></tr><tr><td data-num="324"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx1_BAUD != 14400) \</pre></td></tr><tr><td data-num="325"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx1_BAUD != 19200) \</pre></td></tr><tr><td data-num="326"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx1_BAUD != 38400) \</pre></td></tr><tr><td data-num="327"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx1_BAUD != 115200))</pre></td></tr><tr><td data-num="328"></td><td><pre>        </pre></td></tr><tr><td data-num="329"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_PORT_A09A10 <span class="token operator">+</span> STM32F103xxxx_USARTx1_PORT_B06B07<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="330"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="331"></td><td><pre>            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token string">"There are errors in the STM32F103xxxx_USARTx1_PORT"</span></span></pre></td></tr><tr><td data-num="332"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="333"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if ((STM32F103xxxx_USARTx1_PORT_A09A10 + STM32F103xxxx_USARTx1_PORT_B06B07) != 1)</span></span></pre></td></tr><tr><td data-num="334"></td><td><pre>        </pre></td></tr><tr><td data-num="335"></td><td><pre>        <span class="token comment">// 配置 GPIO 引脚映射功能</span></pre></td></tr><tr><td data-num="336"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_PORT_A09A10 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>                </span><span class="token comment">// 不映射</span></span></pre></td></tr><tr><td data-num="337"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="338"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="339"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1_PORT_A09A10 == 1)</span></span></pre></td></tr><tr><td data-num="340"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_PORT_B06B07 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>                </span><span class="token comment">// 完全映射</span></span></pre></td></tr><tr><td data-num="341"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="342"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_AFIO<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="343"></td><td><pre>            <span class="token function">GPIO_PinRemapConfig</span><span class="token punctuation">(</span>GPIO_Remap_USART1<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="344"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="345"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1_PORT_B06B07 == 1)</span></span></pre></td></tr><tr><td data-num="346"></td><td><pre>        </pre></td></tr><tr><td data-num="347"></td><td><pre>        <span class="token comment">// 配置 GPIO TXD 引脚</span></pre></td></tr><tr><td data-num="348"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_PORT_A09A10 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="349"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="350"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx1_TxD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="351"></td><td><pre>            </pre></td></tr><tr><td data-num="352"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOA<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 使能 GPIOA 模块时钟</span></pre></td></tr><tr><td data-num="353"></td><td><pre>            </pre></td></tr><tr><td data-num="354"></td><td><pre>            GPIO_InitStructure_USARTx1_TxD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_9<span class="token punctuation">;</span>             <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="355"></td><td><pre>            GPIO_InitStructure_USARTx1_TxD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="356"></td><td><pre>            GPIO_InitStructure_USARTx1_TxD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_AF_PP<span class="token punctuation">;</span>        <span class="token comment">// 设置 GPIO 引脚输出类型 推挽输出类型</span></pre></td></tr><tr><td data-num="357"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx1_TxD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="358"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="359"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1_PORT_A09A10 == 1)</span></span></pre></td></tr><tr><td data-num="360"></td><td><pre>   </pre></td></tr><tr><td data-num="361"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_PORT_B06B07 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="362"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="363"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx1_TxD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="364"></td><td><pre>            </pre></td></tr><tr><td data-num="365"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOB<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 使能 GPIOB 模块时钟</span></pre></td></tr><tr><td data-num="366"></td><td><pre>            </pre></td></tr><tr><td data-num="367"></td><td><pre>            GPIO_InitStructure_USARTx1_TxD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_6<span class="token punctuation">;</span>             <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="368"></td><td><pre>            GPIO_InitStructure_USARTx1_TxD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="369"></td><td><pre>            GPIO_InitStructure_USARTx1_TxD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_AF_PP<span class="token punctuation">;</span>        <span class="token comment">// 设置 GPIO 引脚输出类型 推挽输出类型</span></pre></td></tr><tr><td data-num="370"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx1_TxD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="371"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="372"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1_PORT_B06B07 == 1) </span></span></pre></td></tr><tr><td data-num="373"></td><td><pre>        </pre></td></tr><tr><td data-num="374"></td><td><pre>        <span class="token comment">// 配置 GPIO RXD 引脚</span></pre></td></tr><tr><td data-num="375"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_PORT_A09A10 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="376"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="377"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx1_RxD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="378"></td><td><pre>                        </pre></td></tr><tr><td data-num="379"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOA<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 使能 GPIOA 模块时钟</span></pre></td></tr><tr><td data-num="380"></td><td><pre>            </pre></td></tr><tr><td data-num="381"></td><td><pre>            GPIO_InitStructure_USARTx1_RxD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_10<span class="token punctuation">;</span>            <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="382"></td><td><pre>            GPIO_InitStructure_USARTx1_RxD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="383"></td><td><pre>            GPIO_InitStructure_USARTx1_RxD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span>  <span class="token comment">// 设置 GPIO 引脚输出类型 浮空输入类型</span></pre></td></tr><tr><td data-num="384"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx1_RxD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="385"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="386"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1_PORT_A09A10 == 1)</span></span></pre></td></tr><tr><td data-num="387"></td><td><pre>   </pre></td></tr><tr><td data-num="388"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_PORT_B06B07 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="389"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="390"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx1_RxD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="391"></td><td><pre>            </pre></td></tr><tr><td data-num="392"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOB<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 使能 GPIOB 模块时钟</span></pre></td></tr><tr><td data-num="393"></td><td><pre>            </pre></td></tr><tr><td data-num="394"></td><td><pre>            GPIO_InitStructure_USARTx1_RxD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_7<span class="token punctuation">;</span>             <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="395"></td><td><pre>            GPIO_InitStructure_USARTx1_RxD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="396"></td><td><pre>            GPIO_InitStructure_USARTx1_RxD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span>  <span class="token comment">// 设置 GPIO 引脚输出类型 浮空输入类型</span></pre></td></tr><tr><td data-num="397"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx1_RxD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="398"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="399"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1_PORT_B06B07 == 1) </span></span></pre></td></tr><tr><td data-num="400"></td><td><pre>        </pre></td></tr><tr><td data-num="401"></td><td><pre>        <span class="token comment">// 配置 USARTx1 功能</span></pre></td></tr><tr><td data-num="402"></td><td><pre>       <span class="token comment">// USART_InitTypeDef USART_InitStructure_USARTx1;                                          // 定义结构体变量</span></pre></td></tr><tr><td data-num="403"></td><td><pre>        </pre></td></tr><tr><td data-num="404"></td><td><pre>        <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_USART1<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                                  <span class="token comment">// 使能 USART1 模块时钟</span></pre></td></tr><tr><td data-num="405"></td><td><pre>        </pre></td></tr><tr><td data-num="406"></td><td><pre>        <span class="token function">USART_DeInit</span><span class="token punctuation">(</span>USART1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="407"></td><td><pre>        </pre></td></tr><tr><td data-num="408"></td><td><pre>        USART_InitStructure_USARTx1<span class="token punctuation">.</span>USART_BaudRate   <span class="token operator">=</span> STM32F103xxxx_USARTx1_BAUD<span class="token punctuation">;</span>              <span class="token comment">// 设置 USART 波特率</span></pre></td></tr><tr><td data-num="409"></td><td><pre>        USART_InitStructure_USARTx1<span class="token punctuation">.</span>USART_WordLength <span class="token operator">=</span> USART_WordLength_8b<span class="token punctuation">;</span>                     <span class="token comment">// 设置 USART 数据位长度 8 位数据位</span></pre></td></tr><tr><td data-num="410"></td><td><pre>        USART_InitStructure_USARTx1<span class="token punctuation">.</span>USART_StopBits   <span class="token operator">=</span> USART_StopBits_1<span class="token punctuation">;</span>                        <span class="token comment">// 设置 USART 停止位长度 1 位停止位</span></pre></td></tr><tr><td data-num="411"></td><td><pre>        USART_InitStructure_USARTx1<span class="token punctuation">.</span>USART_Parity     <span class="token operator">=</span> USART_Parity_No<span class="token punctuation">;</span>                         <span class="token comment">// 设置 USART 校验位长度 无校验</span></pre></td></tr><tr><td data-num="412"></td><td><pre>        USART_InitStructure_USARTx1<span class="token punctuation">.</span>USART_HardwareFlowControl <span class="token operator">=</span> USART_HardwareFlowControl_None<span class="token punctuation">;</span> <span class="token comment">// 设置 USART 硬件数据流控制</span></pre></td></tr><tr><td data-num="413"></td><td><pre>        USART_InitStructure_USARTx1<span class="token punctuation">.</span>USART_Mode       <span class="token operator">=</span> USART_Mode_Rx <span class="token operator">|</span> USART_Mode_Tx<span class="token punctuation">;</span>           <span class="token comment">// 设置 USART 模式 发送模式 + 接收模式</span></pre></td></tr><tr><td data-num="414"></td><td><pre>        <span class="token function">USART_Init</span><span class="token punctuation">(</span>USART1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>USART_InitStructure_USARTx1<span class="token punctuation">)</span><span class="token punctuation">;</span>                                       <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="415"></td><td><pre>        <span class="token function">USART_Cmd</span><span class="token punctuation">(</span>USART1<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                              <span class="token comment">// 使能 USART1 模块运行</span></pre></td></tr><tr><td data-num="416"></td><td><pre>        </pre></td></tr><tr><td data-num="417"></td><td><pre>        <span class="token comment">// 配置 USARTx1 中断操作</span></pre></td></tr><tr><td data-num="418"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_ITEN_RXNE <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="419"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="420"></td><td><pre>            <span class="token function">USART_ITConfig</span><span class="token punctuation">(</span>USART1<span class="token punctuation">,</span> USART_IT_RXNE<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 启用 USARTx1 接受中断</span></pre></td></tr><tr><td data-num="421"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="422"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1_ITEN_RXNE == 1)</span></span></pre></td></tr><tr><td data-num="423"></td><td><pre>        </pre></td></tr><tr><td data-num="424"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_ITEN_IDLE <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>              </span></span></pre></td></tr><tr><td data-num="425"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="426"></td><td><pre>            <span class="token function">USART_ITConfig</span><span class="token punctuation">(</span>USART1<span class="token punctuation">,</span> USART_IT_IDLE<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 启用 USARTx1 空闲中断</span></pre></td></tr><tr><td data-num="427"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="428"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1_ITEN_IDLE == 1)</span></span></pre></td></tr><tr><td data-num="429"></td><td><pre>        </pre></td></tr><tr><td data-num="430"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_ITEN_TC <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="431"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="432"></td><td><pre>            <span class="token function">USART_ITConfig</span><span class="token punctuation">(</span>USART1<span class="token punctuation">,</span> USART_IT_TC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 启用 USARTx1 发送完成中断</span></pre></td></tr><tr><td data-num="433"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="434"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1_ITEN_TC == 1)</span></span></pre></td></tr><tr><td data-num="435"></td><td><pre>        </pre></td></tr><tr><td data-num="436"></td><td><pre>        <span class="token comment">// 配置 USARTx1 DMA 操作</span></pre></td></tr><tr><td data-num="437"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_DMA_TX <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="438"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="439"></td><td><pre>            <span class="token function">USART_DMACmd</span><span class="token punctuation">(</span>USART1<span class="token punctuation">,</span> USART_DMAReq_Tx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 启用 USARTx1 DMA 发送</span></pre></td></tr><tr><td data-num="440"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="441"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1_DMA_TX == 1)</span></span></pre></td></tr><tr><td data-num="442"></td><td><pre>        </pre></td></tr><tr><td data-num="443"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx1_DMA_RX <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="444"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="445"></td><td><pre>            <span class="token function">USART_DMACmd</span><span class="token punctuation">(</span>USART1<span class="token punctuation">,</span> USART_DMAReq_Rx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 启用 USARTx1 DMA 接收</span></pre></td></tr><tr><td data-num="446"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="447"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1_DMA_RX == 1)</span></span></pre></td></tr><tr><td data-num="448"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="449"></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1 == 1)</span></span></pre></td></tr><tr><td data-num="450"></td><td><pre>    </pre></td></tr><tr><td data-num="451"></td><td><pre>    <span class="token comment">//----------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="452"></td><td><pre>    <span class="token comment">// 配置 USARTx2 功能</span></pre></td></tr><tr><td data-num="453"></td><td><pre>    <span class="token comment">//----------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="454"></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx2 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="455"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="456"></td><td><pre>        <span class="token comment">// 参数检查</span></pre></td></tr><tr><td data-num="457"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>STM32F103xxxx_USARTx2_BAUD <span class="token operator">!=</span> <span class="token number">600</span><span class="token punctuation">)</span>   </span><span class="token punctuation">\</span></span></pre></td></tr><tr><td data-num="458"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx2_BAUD <span class="token operator">!=</span> <span class="token number">1200</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="459"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx2_BAUD <span class="token operator">!=</span> <span class="token number">2400</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="460"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx2_BAUD <span class="token operator">!=</span> <span class="token number">4800</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="461"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx2_BAUD <span class="token operator">!=</span> <span class="token number">9600</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="462"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx2_BAUD <span class="token operator">!=</span> <span class="token number">14400</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="463"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx2_BAUD <span class="token operator">!=</span> <span class="token number">19200</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="464"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx2_BAUD <span class="token operator">!=</span> <span class="token number">38400</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="465"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx2_BAUD <span class="token operator">!=</span> <span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></pre></td></tr><tr><td data-num="466"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="467"></td><td><pre>            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token string">"There are errors in the STM32F103xxxx_USARTx2_BAUD"</span></span></pre></td></tr><tr><td data-num="468"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="469"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if ((STM32F103xxxx_USARTx2_BAUD != 600)   \</span></span></pre></td></tr><tr><td data-num="470"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx2_BAUD != 1200)  \</pre></td></tr><tr><td data-num="471"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx2_BAUD != 2400)  \</pre></td></tr><tr><td data-num="472"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx2_BAUD != 4800)  \</pre></td></tr><tr><td data-num="473"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx2_BAUD != 9600)  \</pre></td></tr><tr><td data-num="474"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx2_BAUD != 14400) \</pre></td></tr><tr><td data-num="475"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx2_BAUD != 19200) \</pre></td></tr><tr><td data-num="476"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx2_BAUD != 38400) \</pre></td></tr><tr><td data-num="477"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx2_BAUD != 115200))</pre></td></tr><tr><td data-num="478"></td><td><pre>        </pre></td></tr><tr><td data-num="479"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>STM32F103xxxx_USARTx2_PORT_A02A03 <span class="token operator">+</span> STM32F103C8T6_USARTx2_PORT_D06D07<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="480"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="481"></td><td><pre>            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token string">"There are errors in the STM32F103xxxx_USARTx2_PORT"</span></span></pre></td></tr><tr><td data-num="482"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="483"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if ((STM32F103xxxx_USARTx2_PORT_A02A03 + STM32F103C8T6_USARTx2_PORT_D06D07) != 1)</span></span></pre></td></tr><tr><td data-num="484"></td><td><pre>        </pre></td></tr><tr><td data-num="485"></td><td><pre>        <span class="token comment">// 配置 GPIO 引脚映射功能</span></pre></td></tr><tr><td data-num="486"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx2_PORT_A02A03 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>                </span><span class="token comment">// 不映射</span></span></pre></td></tr><tr><td data-num="487"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="488"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="489"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx2_PORT_A02A03 == 1)</span></span></pre></td></tr><tr><td data-num="490"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103C8T6_USARTx2_PORT_D06D07 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>                </span><span class="token comment">// 完全映射</span></span></pre></td></tr><tr><td data-num="491"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="492"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_AFIO<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="493"></td><td><pre>            <span class="token function">GPIO_PinRemapConfig</span><span class="token punctuation">(</span>GPIO_FullRemap_USART2<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="494"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="495"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103C8T6_USARTx2_PORT_D06D07 == 1)</span></span></pre></td></tr><tr><td data-num="496"></td><td><pre>        </pre></td></tr><tr><td data-num="497"></td><td><pre>        <span class="token comment">// 配置 GPIO TXD 引脚</span></pre></td></tr><tr><td data-num="498"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx2_PORT_A02A03 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="499"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="500"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx2_TxD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="501"></td><td><pre>            </pre></td></tr><tr><td data-num="502"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOA<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 使能 GPIOA 模块时钟</span></pre></td></tr><tr><td data-num="503"></td><td><pre>            </pre></td></tr><tr><td data-num="504"></td><td><pre>            GPIO_InitStructure_USARTx2_TxD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_2<span class="token punctuation">;</span>             <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="505"></td><td><pre>            GPIO_InitStructure_USARTx2_TxD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="506"></td><td><pre>            GPIO_InitStructure_USARTx2_TxD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_AF_PP<span class="token punctuation">;</span>        <span class="token comment">// 设置 GPIO 引脚输出类型 推挽输出类型</span></pre></td></tr><tr><td data-num="507"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx2_TxD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="508"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="509"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx2_PORT_A02A03 == 1)</span></span></pre></td></tr><tr><td data-num="510"></td><td><pre>   </pre></td></tr><tr><td data-num="511"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103C8T6_USARTx2_PORT_D06D07 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="512"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="513"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx2_TxD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="514"></td><td><pre>            </pre></td></tr><tr><td data-num="515"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOD<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 使能 GPIOD 模块时钟</span></pre></td></tr><tr><td data-num="516"></td><td><pre>            </pre></td></tr><tr><td data-num="517"></td><td><pre>            GPIO_InitStructure_USARTx2_TxD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_6<span class="token punctuation">;</span>             <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="518"></td><td><pre>            GPIO_InitStructure_USARTx2_TxD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="519"></td><td><pre>            GPIO_InitStructure_USARTx2_TxD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_AF_PP<span class="token punctuation">;</span>        <span class="token comment">// 设置 GPIO 引脚输出类型 推挽输出类型</span></pre></td></tr><tr><td data-num="520"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx2_TxD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="521"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="522"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103C8T6_USARTx2_PORT_D06D07 == 1) </span></span></pre></td></tr><tr><td data-num="523"></td><td><pre>        </pre></td></tr><tr><td data-num="524"></td><td><pre>        <span class="token comment">// 配置 GPIO RXD 引脚</span></pre></td></tr><tr><td data-num="525"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx2_PORT_A02A03 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="526"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="527"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx2_RxD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="528"></td><td><pre>                        </pre></td></tr><tr><td data-num="529"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOA<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 使能 GPIOA 模块时钟</span></pre></td></tr><tr><td data-num="530"></td><td><pre>            </pre></td></tr><tr><td data-num="531"></td><td><pre>            GPIO_InitStructure_USARTx2_RxD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_3<span class="token punctuation">;</span>             <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="532"></td><td><pre>            GPIO_InitStructure_USARTx2_RxD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="533"></td><td><pre>            GPIO_InitStructure_USARTx2_RxD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span>  <span class="token comment">// 设置 GPIO 引脚输出类型 浮空输入类型</span></pre></td></tr><tr><td data-num="534"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx2_RxD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="535"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="536"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx2_PORT_A02A03 == 1)</span></span></pre></td></tr><tr><td data-num="537"></td><td><pre>   </pre></td></tr><tr><td data-num="538"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103C8T6_USARTx2_PORT_D06D07 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="539"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="540"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx2_RxD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="541"></td><td><pre>            </pre></td></tr><tr><td data-num="542"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOD<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 使能 GPIOD 模块时钟</span></pre></td></tr><tr><td data-num="543"></td><td><pre>            </pre></td></tr><tr><td data-num="544"></td><td><pre>            GPIO_InitStructure_USARTx2_RxD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_7<span class="token punctuation">;</span>             <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="545"></td><td><pre>            GPIO_InitStructure_USARTx2_RxD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="546"></td><td><pre>            GPIO_InitStructure_USARTx2_RxD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span>  <span class="token comment">// 设置 GPIO 引脚输出类型 浮空输入类型</span></pre></td></tr><tr><td data-num="547"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx2_RxD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="548"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="549"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103C8T6_USARTx2_PORT_D06D07 == 1) </span></span></pre></td></tr><tr><td data-num="550"></td><td><pre>        </pre></td></tr><tr><td data-num="551"></td><td><pre>        <span class="token comment">// 配置 USARTx2 功能</span></pre></td></tr><tr><td data-num="552"></td><td><pre>        USART_InitTypeDef USART_InitStructure_USARTx2<span class="token punctuation">;</span>                                          <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="553"></td><td><pre>        </pre></td></tr><tr><td data-num="554"></td><td><pre>        <span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB1Periph_USART2<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                                  <span class="token comment">// 使能 USART2 模块时钟</span></pre></td></tr><tr><td data-num="555"></td><td><pre>        </pre></td></tr><tr><td data-num="556"></td><td><pre>        <span class="token function">USART_DeInit</span><span class="token punctuation">(</span>USART2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="557"></td><td><pre>        </pre></td></tr><tr><td data-num="558"></td><td><pre>        USART_InitStructure_USARTx2<span class="token punctuation">.</span>USART_BaudRate   <span class="token operator">=</span> STM32F103xxxx_USARTx2_BAUD<span class="token punctuation">;</span>              <span class="token comment">// 设置 USART 波特率</span></pre></td></tr><tr><td data-num="559"></td><td><pre>        USART_InitStructure_USARTx2<span class="token punctuation">.</span>USART_WordLength <span class="token operator">=</span> USART_WordLength_8b<span class="token punctuation">;</span>                     <span class="token comment">// 设置 USART 数据位长度 8 位数据位</span></pre></td></tr><tr><td data-num="560"></td><td><pre>        USART_InitStructure_USARTx2<span class="token punctuation">.</span>USART_StopBits   <span class="token operator">=</span> USART_StopBits_1<span class="token punctuation">;</span>                        <span class="token comment">// 设置 USART 停止位长度 1 位停止位</span></pre></td></tr><tr><td data-num="561"></td><td><pre>        USART_InitStructure_USARTx2<span class="token punctuation">.</span>USART_Parity     <span class="token operator">=</span> USART_Parity_No<span class="token punctuation">;</span>                         <span class="token comment">// 设置 USART 校验位长度 无校验</span></pre></td></tr><tr><td data-num="562"></td><td><pre>        USART_InitStructure_USARTx2<span class="token punctuation">.</span>USART_HardwareFlowControl <span class="token operator">=</span> USART_HardwareFlowControl_None<span class="token punctuation">;</span> <span class="token comment">// 设置 USART 硬件数据流控制</span></pre></td></tr><tr><td data-num="563"></td><td><pre>        USART_InitStructure_USARTx2<span class="token punctuation">.</span>USART_Mode       <span class="token operator">=</span> USART_Mode_Rx <span class="token operator">|</span> USART_Mode_Tx<span class="token punctuation">;</span>           <span class="token comment">// 设置 USART 模式 发送模式 + 接收模式</span></pre></td></tr><tr><td data-num="564"></td><td><pre>        <span class="token function">USART_Init</span><span class="token punctuation">(</span>USART2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>USART_InitStructure_USARTx2<span class="token punctuation">)</span><span class="token punctuation">;</span>                                       <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="565"></td><td><pre>        <span class="token function">USART_Cmd</span><span class="token punctuation">(</span>USART2<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                              <span class="token comment">// 使能 USART2 模块运行</span></pre></td></tr><tr><td data-num="566"></td><td><pre>        </pre></td></tr><tr><td data-num="567"></td><td><pre>        <span class="token comment">// 配置 USARTx2 中断操作</span></pre></td></tr><tr><td data-num="568"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx2_ITEN_RXNE <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="569"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="570"></td><td><pre>            <span class="token function">USART_ITConfig</span><span class="token punctuation">(</span>USART2<span class="token punctuation">,</span> USART_IT_RXNE<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 启用 USARTx2 接受中断</span></pre></td></tr><tr><td data-num="571"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="572"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx2_ITEN_RXNE == 1)</span></span></pre></td></tr><tr><td data-num="573"></td><td><pre>        </pre></td></tr><tr><td data-num="574"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx2_ITEN_IDLE <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>              </span></span></pre></td></tr><tr><td data-num="575"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="576"></td><td><pre>            <span class="token function">USART_ITConfig</span><span class="token punctuation">(</span>USART2<span class="token punctuation">,</span> USART_IT_IDLE<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 启用 USARTx2 空闲中断</span></pre></td></tr><tr><td data-num="577"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="578"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx2_ITEN_IDLE == 1)</span></span></pre></td></tr><tr><td data-num="579"></td><td><pre>        </pre></td></tr><tr><td data-num="580"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx2_ITEN_TC <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="581"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="582"></td><td><pre>            <span class="token function">USART_ITConfig</span><span class="token punctuation">(</span>USART2<span class="token punctuation">,</span> USART_IT_TC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 启用 USARTx2 发送完成中断</span></pre></td></tr><tr><td data-num="583"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="584"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx2_ITEN_TC == 1)</span></span></pre></td></tr><tr><td data-num="585"></td><td><pre>        </pre></td></tr><tr><td data-num="586"></td><td><pre>        <span class="token comment">// 配置 USARTx2 DMA 操作</span></pre></td></tr><tr><td data-num="587"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx2_DMA_TX <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="588"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="589"></td><td><pre>            <span class="token function">USART_DMACmd</span><span class="token punctuation">(</span>USART2<span class="token punctuation">,</span> USART_DMAReq_Tx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 启用 USARTx2 DMA 发送</span></pre></td></tr><tr><td data-num="590"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="591"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx2_DMA_TX == 1)</span></span></pre></td></tr><tr><td data-num="592"></td><td><pre>        </pre></td></tr><tr><td data-num="593"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx2_DMA_RX <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="594"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="595"></td><td><pre>            <span class="token function">USART_DMACmd</span><span class="token punctuation">(</span>USART2<span class="token punctuation">,</span> USART_DMAReq_Rx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 启用 USARTx2 DMA 接收</span></pre></td></tr><tr><td data-num="596"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="597"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx2_DMA_RX == 1)</span></span></pre></td></tr><tr><td data-num="598"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="599"></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx1 == 1)</span></span></pre></td></tr><tr><td data-num="600"></td><td><pre>    </pre></td></tr><tr><td data-num="601"></td><td><pre>    <span class="token comment">//----------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="602"></td><td><pre>    <span class="token comment">// 配置 USARTx3 功能</span></pre></td></tr><tr><td data-num="603"></td><td><pre>    <span class="token comment">//----------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="604"></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>  </span></span></pre></td></tr><tr><td data-num="605"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="606"></td><td><pre>        <span class="token comment">// 参数检查</span></pre></td></tr><tr><td data-num="607"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_BAUD <span class="token operator">!=</span> <span class="token number">600</span><span class="token punctuation">)</span>   </span><span class="token punctuation">\</span></span></pre></td></tr><tr><td data-num="608"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx3_BAUD <span class="token operator">!=</span> <span class="token number">1200</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="609"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx3_BAUD <span class="token operator">!=</span> <span class="token number">2400</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="610"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx3_BAUD <span class="token operator">!=</span> <span class="token number">4800</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="611"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx3_BAUD <span class="token operator">!=</span> <span class="token number">9600</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="612"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx3_BAUD <span class="token operator">!=</span> <span class="token number">14400</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="613"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx3_BAUD <span class="token operator">!=</span> <span class="token number">19200</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="614"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx3_BAUD <span class="token operator">!=</span> <span class="token number">38400</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="615"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_USARTx3_BAUD <span class="token operator">!=</span> <span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></pre></td></tr><tr><td data-num="616"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="617"></td><td><pre>            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token string">"There are errors in the STM32F103xxxx_USARTx3_BAUD"</span></span></pre></td></tr><tr><td data-num="618"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="619"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if ((STM32F103xxxx_USARTx3_BAUD != 600)   \</span></span></pre></td></tr><tr><td data-num="620"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx3_BAUD != 1200)  \</pre></td></tr><tr><td data-num="621"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx3_BAUD != 2400)  \</pre></td></tr><tr><td data-num="622"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx3_BAUD != 4800)  \</pre></td></tr><tr><td data-num="623"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx3_BAUD != 9600)  \</pre></td></tr><tr><td data-num="624"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx3_BAUD != 14400) \</pre></td></tr><tr><td data-num="625"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx3_BAUD != 19200) \</pre></td></tr><tr><td data-num="626"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx3_BAUD != 38400) \</pre></td></tr><tr><td data-num="627"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_USARTx3_BAUD != 115200))</pre></td></tr><tr><td data-num="628"></td><td><pre>        </pre></td></tr><tr><td data-num="629"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_PORT_B10B11 <span class="token operator">+</span> STM32F103xxxx_USARTx3_PORT_C10C11 <span class="token operator">+</span> STM32F103xxxx_USARTx3_PORT_D08D09<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="630"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="631"></td><td><pre>            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token string">"There are errors in the STM32F103xxxx_USARTx3_PORT"</span></span></pre></td></tr><tr><td data-num="632"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="633"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if ((STM32F103xxxx_USARTx3_PORT_B10B11 + STM32F103xxxx_USARTx3_PORT_C10C11 + STM32F103xxxx_USARTx3_PORT_D08D09) != 1)</span></span></pre></td></tr><tr><td data-num="634"></td><td><pre></pre></td></tr><tr><td data-num="635"></td><td><pre>        <span class="token comment">// 配置 GPIO 引脚映射功能</span></pre></td></tr><tr><td data-num="636"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_PORT_B10B11 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>                </span><span class="token comment">// 不映射</span></span></pre></td></tr><tr><td data-num="637"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="638"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="639"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_PORT_B10B11 == 1)</span></span></pre></td></tr><tr><td data-num="640"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_PORT_C10C11 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>                </span><span class="token comment">// 部分映射</span></span></pre></td></tr><tr><td data-num="641"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="642"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_AFIO<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="643"></td><td><pre>            <span class="token function">GPIO_PinRemapConfig</span><span class="token punctuation">(</span>GPIO_PartialRemap_USART3<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="644"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="645"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_PORT_C10C11 == 1)</span></span></pre></td></tr><tr><td data-num="646"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_PORT_D08D09 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>                </span><span class="token comment">// 完全映射</span></span></pre></td></tr><tr><td data-num="647"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="648"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_AFIO<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="649"></td><td><pre>            <span class="token function">GPIO_PinRemapConfig</span><span class="token punctuation">(</span>GPIO_FullRemap_USART3<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="650"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="651"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_PORT_D08D09 == 1)</span></span></pre></td></tr><tr><td data-num="652"></td><td><pre></pre></td></tr><tr><td data-num="653"></td><td><pre>        <span class="token comment">// 配置 GPIO TXD 引脚</span></pre></td></tr><tr><td data-num="654"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_PORT_B10B11 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="655"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="656"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="657"></td><td><pre></pre></td></tr><tr><td data-num="658"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOB<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 使能 GPIOB 模块时钟</span></pre></td></tr><tr><td data-num="659"></td><td><pre></pre></td></tr><tr><td data-num="660"></td><td><pre>            GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_10<span class="token punctuation">;</span>            <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="661"></td><td><pre>            GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="662"></td><td><pre>            GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_AF_PP<span class="token punctuation">;</span>        <span class="token comment">// 设置 GPIO 引脚输出类型 推挽输出类型</span></pre></td></tr><tr><td data-num="663"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="664"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="665"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_PORT_B10B11 == 1)</span></span></pre></td></tr><tr><td data-num="666"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_PORT_C10C11 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="667"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="668"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="669"></td><td><pre></pre></td></tr><tr><td data-num="670"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 使能 GPIOC 模块时钟</span></pre></td></tr><tr><td data-num="671"></td><td><pre></pre></td></tr><tr><td data-num="672"></td><td><pre>            GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_10<span class="token punctuation">;</span>            <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="673"></td><td><pre>            GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="674"></td><td><pre>            GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_AF_PP<span class="token punctuation">;</span>        <span class="token comment">// 设置 GPIO 引脚输出类型 推挽输出类型</span></pre></td></tr><tr><td data-num="675"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOC<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="676"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="677"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_PORT_C10C11 == 1)</span></span></pre></td></tr><tr><td data-num="678"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_PORT_D08D09 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="679"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="680"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="681"></td><td><pre></pre></td></tr><tr><td data-num="682"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOD<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 使能 GPIOD 模块时钟</span></pre></td></tr><tr><td data-num="683"></td><td><pre></pre></td></tr><tr><td data-num="684"></td><td><pre>            GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_8<span class="token punctuation">;</span>             <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="685"></td><td><pre>            GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="686"></td><td><pre>            GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_AF_PP<span class="token punctuation">;</span>        <span class="token comment">// 设置 GPIO 引脚输出类型 推挽输出类型</span></pre></td></tr><tr><td data-num="687"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx3_TXD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="688"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="689"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_PORT_D08D09 == 1)</span></span></pre></td></tr><tr><td data-num="690"></td><td><pre>        </pre></td></tr><tr><td data-num="691"></td><td><pre>        <span class="token comment">// 配置 GPIO RXD 引脚</span></pre></td></tr><tr><td data-num="692"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_PORT_B10B11 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="693"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="694"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="695"></td><td><pre></pre></td></tr><tr><td data-num="696"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOB<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 使能 GPIOB 模块时钟</span></pre></td></tr><tr><td data-num="697"></td><td><pre></pre></td></tr><tr><td data-num="698"></td><td><pre>            GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_11<span class="token punctuation">;</span>            <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="699"></td><td><pre>            GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="700"></td><td><pre>            GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span>  <span class="token comment">// 设置 GPIO 引脚输出类型 浮空输入类型</span></pre></td></tr><tr><td data-num="701"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="702"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="703"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_PORT_B10B11 == 1)</span></span></pre></td></tr><tr><td data-num="704"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_PORT_C10C11 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="705"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="706"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="707"></td><td><pre></pre></td></tr><tr><td data-num="708"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 使能 GPIOC 模块时钟</span></pre></td></tr><tr><td data-num="709"></td><td><pre></pre></td></tr><tr><td data-num="710"></td><td><pre>            GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_11<span class="token punctuation">;</span>            <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="711"></td><td><pre>            GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="712"></td><td><pre>            GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span>  <span class="token comment">// 设置 GPIO 引脚输出类型 浮空输入类型</span></pre></td></tr><tr><td data-num="713"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOC<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="714"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="715"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_PORT_C10C11 == 1)</span></span></pre></td></tr><tr><td data-num="716"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_PORT_D08D09 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="717"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="718"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">;</span>                    <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="719"></td><td><pre></pre></td></tr><tr><td data-num="720"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOD<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 使能 GPIOD 模块时钟</span></pre></td></tr><tr><td data-num="721"></td><td><pre></pre></td></tr><tr><td data-num="722"></td><td><pre>            GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_9<span class="token punctuation">;</span>             <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="723"></td><td><pre>            GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>       <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="724"></td><td><pre>            GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span>  <span class="token comment">// 设置 GPIO 引脚输出类型 浮空输入类型</span></pre></td></tr><tr><td data-num="725"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_USARTx3_RXD<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="726"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="727"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_PORT_D08D09 == 1)</span></span></pre></td></tr><tr><td data-num="728"></td><td><pre>        </pre></td></tr><tr><td data-num="729"></td><td><pre>        <span class="token comment">// 配置 USARTx3 功能</span></pre></td></tr><tr><td data-num="730"></td><td><pre>        USART_InitTypeDef USART_InitStructure_USARTx3<span class="token punctuation">;</span>                                          <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="731"></td><td><pre>        </pre></td></tr><tr><td data-num="732"></td><td><pre>        <span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB1Periph_USART3<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                                  <span class="token comment">// 使能 USART3 模块时钟</span></pre></td></tr><tr><td data-num="733"></td><td><pre>        </pre></td></tr><tr><td data-num="734"></td><td><pre>        <span class="token function">USART_DeInit</span><span class="token punctuation">(</span>USART3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="735"></td><td><pre>        </pre></td></tr><tr><td data-num="736"></td><td><pre>        USART_InitStructure_USARTx3<span class="token punctuation">.</span>USART_BaudRate   <span class="token operator">=</span> STM32F103xxxx_USARTx3_BAUD<span class="token punctuation">;</span>              <span class="token comment">// 设置 USART 波特率</span></pre></td></tr><tr><td data-num="737"></td><td><pre>        USART_InitStructure_USARTx3<span class="token punctuation">.</span>USART_WordLength <span class="token operator">=</span> USART_WordLength_8b<span class="token punctuation">;</span>                     <span class="token comment">// 设置 USART 数据位长度 8 位数据位</span></pre></td></tr><tr><td data-num="738"></td><td><pre>        USART_InitStructure_USARTx3<span class="token punctuation">.</span>USART_StopBits   <span class="token operator">=</span> USART_StopBits_1<span class="token punctuation">;</span>                        <span class="token comment">// 设置 USART 停止位长度 1 位停止位</span></pre></td></tr><tr><td data-num="739"></td><td><pre>        USART_InitStructure_USARTx3<span class="token punctuation">.</span>USART_Parity     <span class="token operator">=</span> USART_Parity_No<span class="token punctuation">;</span>                         <span class="token comment">// 设置 USART 校验位长度 无校验</span></pre></td></tr><tr><td data-num="740"></td><td><pre>        USART_InitStructure_USARTx3<span class="token punctuation">.</span>USART_HardwareFlowControl <span class="token operator">=</span> USART_HardwareFlowControl_None<span class="token punctuation">;</span> <span class="token comment">// 设置 USART 硬件数据流控制</span></pre></td></tr><tr><td data-num="741"></td><td><pre>        USART_InitStructure_USARTx3<span class="token punctuation">.</span>USART_Mode       <span class="token operator">=</span> USART_Mode_Rx <span class="token operator">|</span> USART_Mode_Tx<span class="token punctuation">;</span>           <span class="token comment">// 设置 USART 模式 发送模式 + 接收模式</span></pre></td></tr><tr><td data-num="742"></td><td><pre>        <span class="token function">USART_Init</span><span class="token punctuation">(</span>USART3<span class="token punctuation">,</span> <span class="token operator">&amp;</span>USART_InitStructure_USARTx3<span class="token punctuation">)</span><span class="token punctuation">;</span>                                       <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="743"></td><td><pre>        <span class="token function">USART_Cmd</span><span class="token punctuation">(</span>USART3<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                              <span class="token comment">// 使能 USART3 模块运行</span></pre></td></tr><tr><td data-num="744"></td><td><pre>        </pre></td></tr><tr><td data-num="745"></td><td><pre>        <span class="token comment">// 配置 USARTx3 中断操作</span></pre></td></tr><tr><td data-num="746"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_ITEN_RXNE <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="747"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="748"></td><td><pre>            <span class="token function">USART_ITConfig</span><span class="token punctuation">(</span>USART3<span class="token punctuation">,</span> USART_IT_RXNE<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 启用 USARTx3 接受中断</span></pre></td></tr><tr><td data-num="749"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="750"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_ITEN_RXNE == 1)</span></span></pre></td></tr><tr><td data-num="751"></td><td><pre>        </pre></td></tr><tr><td data-num="752"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_ITEN_IDLE <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>              </span></span></pre></td></tr><tr><td data-num="753"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="754"></td><td><pre>            <span class="token function">USART_ITConfig</span><span class="token punctuation">(</span>USART3<span class="token punctuation">,</span> USART_IT_IDLE<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 启用 USARTx3 空闲中断</span></pre></td></tr><tr><td data-num="755"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="756"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_ITEN_IDLE == 1)</span></span></pre></td></tr><tr><td data-num="757"></td><td><pre>        </pre></td></tr><tr><td data-num="758"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_ITEN_TC <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="759"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="760"></td><td><pre>            <span class="token function">USART_ITConfig</span><span class="token punctuation">(</span>USART3<span class="token punctuation">,</span> USART_IT_TC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 启用 USARTx3 发送完成中断</span></pre></td></tr><tr><td data-num="761"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="762"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_ITEN_TC == 1)</span></span></pre></td></tr><tr><td data-num="763"></td><td><pre>        </pre></td></tr><tr><td data-num="764"></td><td><pre>        <span class="token comment">// 配置 USARTx3 DMA 操作</span></pre></td></tr><tr><td data-num="765"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_DMA_TX <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="766"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="767"></td><td><pre>            <span class="token function">USART_DMACmd</span><span class="token punctuation">(</span>USART3<span class="token punctuation">,</span> USART_DMAReq_Tx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 启用 USARTx3 DMA 发送</span></pre></td></tr><tr><td data-num="768"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="769"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_DMA_TX == 1)</span></span></pre></td></tr><tr><td data-num="770"></td><td><pre>        </pre></td></tr><tr><td data-num="771"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_USARTx3_DMA_RX <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="772"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="773"></td><td><pre>            <span class="token function">USART_DMACmd</span><span class="token punctuation">(</span>USART3<span class="token punctuation">,</span> USART_DMAReq_Rx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 启用 USARTx3 DMA 接收</span></pre></td></tr><tr><td data-num="774"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="775"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3_DMA_RX == 1)</span></span></pre></td></tr><tr><td data-num="776"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="777"></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_USARTx3 == 1)</span></span></pre></td></tr><tr><td data-num="778"></td><td><pre>    </pre></td></tr><tr><td data-num="779"></td><td><pre>    <span class="token comment">//----------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="780"></td><td><pre>    <span class="token comment">// 配置 UARTx4 功能</span></pre></td></tr><tr><td data-num="781"></td><td><pre>    <span class="token comment">//----------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="782"></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_UARTx4 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>    </span></span></pre></td></tr><tr><td data-num="783"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="784"></td><td><pre>        <span class="token comment">// 参数检查</span></pre></td></tr><tr><td data-num="785"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>STM32F103xxxx_UARTx4_BAUD <span class="token operator">!=</span> <span class="token number">600</span><span class="token punctuation">)</span>   </span><span class="token punctuation">\</span></span></pre></td></tr><tr><td data-num="786"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_UARTx4_BAUD <span class="token operator">!=</span> <span class="token number">1200</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="787"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_UARTx4_BAUD <span class="token operator">!=</span> <span class="token number">2400</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="788"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_UARTx4_BAUD <span class="token operator">!=</span> <span class="token number">4800</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="789"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_UARTx4_BAUD <span class="token operator">!=</span> <span class="token number">9600</span><span class="token punctuation">)</span>  </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="790"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_UARTx4_BAUD <span class="token operator">!=</span> <span class="token number">14400</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="791"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_UARTx4_BAUD <span class="token operator">!=</span> <span class="token number">19200</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="792"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_UARTx4_BAUD <span class="token operator">!=</span> <span class="token number">38400</span><span class="token punctuation">)</span> </span><span class="token punctuation">\</span></pre></td></tr><tr><td data-num="793"></td><td><pre>        <span class="token expression"><span class="token operator">&amp;&amp;</span>   <span class="token punctuation">(</span>STM32F103xxxx_UARTx4_BAUD <span class="token operator">!=</span> <span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></pre></td></tr><tr><td data-num="794"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="795"></td><td><pre>            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token string">"There are errors in the STM32F103xxxx_UARTx4_BAUD"</span></span></pre></td></tr><tr><td data-num="796"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="797"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if ((STM32F103xxxx_UARTx4_BAUD != 600)   \</span></span></pre></td></tr><tr><td data-num="798"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_UARTx4_BAUD != 1200)  \</pre></td></tr><tr><td data-num="799"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_UARTx4_BAUD != 2400)  \</pre></td></tr><tr><td data-num="800"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_UARTx4_BAUD != 4800)  \</pre></td></tr><tr><td data-num="801"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_UARTx4_BAUD != 9600)  \</pre></td></tr><tr><td data-num="802"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_UARTx4_BAUD != 14400) \</pre></td></tr><tr><td data-num="803"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_UARTx4_BAUD != 19200) \</pre></td></tr><tr><td data-num="804"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_UARTx4_BAUD != 38400) \</pre></td></tr><tr><td data-num="805"></td><td><pre>                   &amp;&amp;   (STM32F103xxxx_UARTx4_BAUD != 115200))</pre></td></tr><tr><td data-num="806"></td><td><pre>        </pre></td></tr><tr><td data-num="807"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_UARTx4_PORT_C10C11 <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="808"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="809"></td><td><pre>            <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token string">"There are errors in the STM32F103xxxx_UARTx4_PORT"</span></span></pre></td></tr><tr><td data-num="810"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="811"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_UARTx4_PORT_C10C11 != 1)</span></span></pre></td></tr><tr><td data-num="812"></td><td><pre>        </pre></td></tr><tr><td data-num="813"></td><td><pre>        <span class="token comment">// 配置 GPIO 引脚映射功能</span></pre></td></tr><tr><td data-num="814"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_UARTx4_PORT_C10C11 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>                 </span><span class="token comment">// 不映射</span></span></pre></td></tr><tr><td data-num="815"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="816"></td><td><pre>        </pre></td></tr><tr><td data-num="817"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="818"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_UARTx4_PORT_C10C11 == 1)</span></span></pre></td></tr><tr><td data-num="819"></td><td><pre>        </pre></td></tr><tr><td data-num="820"></td><td><pre>        <span class="token comment">// 配置 GPIO TXD 引脚</span></pre></td></tr><tr><td data-num="821"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_UARTx4_PORT_C10C11 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="822"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="823"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_UARTx4_TXD<span class="token punctuation">;</span>                     <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="824"></td><td><pre></pre></td></tr><tr><td data-num="825"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 使能 GPIOC 模块时钟</span></pre></td></tr><tr><td data-num="826"></td><td><pre></pre></td></tr><tr><td data-num="827"></td><td><pre>            GPIO_InitStructure_UARTx4_TXD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_10<span class="token punctuation">;</span>             <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="828"></td><td><pre>            GPIO_InitStructure_UARTx4_TXD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>        <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="829"></td><td><pre>            GPIO_InitStructure_UARTx4_TXD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_AF_PP<span class="token punctuation">;</span>         <span class="token comment">// 设置 GPIO 引脚输出类型 推挽输出类型</span></pre></td></tr><tr><td data-num="830"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOC<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_UARTx4_TXD<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="831"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="832"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_UARTx4_PORT_C10C11 == 1)</span></span></pre></td></tr><tr><td data-num="833"></td><td><pre>        </pre></td></tr><tr><td data-num="834"></td><td><pre>        <span class="token comment">// 配置 GPIO RXD 引脚</span></pre></td></tr><tr><td data-num="835"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_UARTx4_PORT_C10C11 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="836"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="837"></td><td><pre>            GPIO_InitTypeDef GPIO_InitStructure_UARTx4_TXD<span class="token punctuation">;</span>                     <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="838"></td><td><pre></pre></td></tr><tr><td data-num="839"></td><td><pre>            <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 使能 GPIOC 模块时钟</span></pre></td></tr><tr><td data-num="840"></td><td><pre></pre></td></tr><tr><td data-num="841"></td><td><pre>            GPIO_InitStructure_UARTx4_TXD<span class="token punctuation">.</span>GPIO_Pin   <span class="token operator">=</span> GPIO_Pin_11<span class="token punctuation">;</span>             <span class="token comment">// 设置 GPIO 引脚号</span></pre></td></tr><tr><td data-num="842"></td><td><pre>            GPIO_InitStructure_UARTx4_TXD<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>        <span class="token comment">// 设置 GPIO 引脚速率</span></pre></td></tr><tr><td data-num="843"></td><td><pre>            GPIO_InitStructure_UARTx4_TXD<span class="token punctuation">.</span>GPIO_Mode  <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span>   <span class="token comment">// 设置 GPIO 引脚输出类型 浮空输入类型</span></pre></td></tr><tr><td data-num="844"></td><td><pre>            <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOC<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure_UARTx4_TXD<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="845"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="846"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_UARTx4_PORT_C10C11 == 1)</span></span></pre></td></tr><tr><td data-num="847"></td><td><pre></pre></td></tr><tr><td data-num="848"></td><td><pre>        <span class="token comment">// 配置 UARTx4 功能</span></pre></td></tr><tr><td data-num="849"></td><td><pre>        USART_InitTypeDef USART_InitStructure_UARTx4<span class="token punctuation">;</span>                                           <span class="token comment">// 定义结构体变量</span></pre></td></tr><tr><td data-num="850"></td><td><pre>        </pre></td></tr><tr><td data-num="851"></td><td><pre>        <span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB1Periph_UART4<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                                   <span class="token comment">// 使能 UART4 模块时钟</span></pre></td></tr><tr><td data-num="852"></td><td><pre>        </pre></td></tr><tr><td data-num="853"></td><td><pre>        <span class="token function">USART_DeInit</span><span class="token punctuation">(</span>UART4<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="854"></td><td><pre>        </pre></td></tr><tr><td data-num="855"></td><td><pre>        USART_InitStructure_UARTx4<span class="token punctuation">.</span>USART_BaudRate   <span class="token operator">=</span> STM32F103xxxx_UARTx4_BAUD<span class="token punctuation">;</span>                <span class="token comment">// 设置 USART 波特率</span></pre></td></tr><tr><td data-num="856"></td><td><pre>        USART_InitStructure_UARTx4<span class="token punctuation">.</span>USART_WordLength <span class="token operator">=</span> USART_WordLength_8b<span class="token punctuation">;</span>                      <span class="token comment">// 设置 USART 数据位长度 8 位数据位</span></pre></td></tr><tr><td data-num="857"></td><td><pre>        USART_InitStructure_UARTx4<span class="token punctuation">.</span>USART_StopBits   <span class="token operator">=</span> USART_StopBits_1<span class="token punctuation">;</span>                         <span class="token comment">// 设置 USART 停止位长度 1 位停止位</span></pre></td></tr><tr><td data-num="858"></td><td><pre>        USART_InitStructure_UARTx4<span class="token punctuation">.</span>USART_Parity     <span class="token operator">=</span> USART_Parity_No<span class="token punctuation">;</span>                          <span class="token comment">// 设置 USART 校验位长度 无校验</span></pre></td></tr><tr><td data-num="859"></td><td><pre>        USART_InitStructure_UARTx4<span class="token punctuation">.</span>USART_HardwareFlowControl <span class="token operator">=</span> USART_HardwareFlowControl_None<span class="token punctuation">;</span>  <span class="token comment">// 设置 USART 硬件数据流控制</span></pre></td></tr><tr><td data-num="860"></td><td><pre>        USART_InitStructure_UARTx4<span class="token punctuation">.</span>USART_Mode       <span class="token operator">=</span> USART_Mode_Rx <span class="token operator">|</span> USART_Mode_Tx<span class="token punctuation">;</span>            <span class="token comment">// 设置 USART 模式 发送模式 + 接收模式</span></pre></td></tr><tr><td data-num="861"></td><td><pre>        <span class="token function">USART_Init</span><span class="token punctuation">(</span>UART4<span class="token punctuation">,</span> <span class="token operator">&amp;</span>USART_InitStructure_UARTx4<span class="token punctuation">)</span><span class="token punctuation">;</span>                                         <span class="token comment">// 初始化结构体</span></pre></td></tr><tr><td data-num="862"></td><td><pre>        <span class="token function">USART_Cmd</span><span class="token punctuation">(</span>UART4<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                               <span class="token comment">// 使能 UART4 模块运行</span></pre></td></tr><tr><td data-num="863"></td><td><pre>        </pre></td></tr><tr><td data-num="864"></td><td><pre>        <span class="token comment">// 配置 UARTx4 中断操作</span></pre></td></tr><tr><td data-num="865"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_UARTx4_ITEN_RXNE <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="866"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="867"></td><td><pre>            <span class="token function">USART_ITConfig</span><span class="token punctuation">(</span>UART4<span class="token punctuation">,</span> USART_IT_RXNE<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 启用 UARTx4 接受中断</span></pre></td></tr><tr><td data-num="868"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="869"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_UARTx4_ITEN_RXNE == 1)</span></span></pre></td></tr><tr><td data-num="870"></td><td><pre>        </pre></td></tr><tr><td data-num="871"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_UARTx4_ITEN_IDLE <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="872"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="873"></td><td><pre>            <span class="token function">USART_ITConfig</span><span class="token punctuation">(</span>UART4<span class="token punctuation">,</span> USART_IT_IDLE<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 启用 UARTx4 空闲中断</span></pre></td></tr><tr><td data-num="874"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="875"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_UARTx4_ITEN_IDLE == 1)</span></span></pre></td></tr><tr><td data-num="876"></td><td><pre>        </pre></td></tr><tr><td data-num="877"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_UARTx4_ITEN_TC <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="878"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="879"></td><td><pre>            <span class="token function">USART_ITConfig</span><span class="token punctuation">(</span>UART4<span class="token punctuation">,</span> USART_IT_TC<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// 启用 UARTx4 发送完成中断</span></pre></td></tr><tr><td data-num="880"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="881"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_UARTx4_ITEN_TC == 1)</span></span></pre></td></tr><tr><td data-num="882"></td><td><pre>        </pre></td></tr><tr><td data-num="883"></td><td><pre>        <span class="token comment">// 配置 UARTx4 DMA 操作</span></pre></td></tr><tr><td data-num="884"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_UARTx4_DMA_TX <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="885"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="886"></td><td><pre>            <span class="token function">USART_DMACmd</span><span class="token punctuation">(</span>UART4<span class="token punctuation">,</span> USART_DMAReq_Tx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 启用 UARTx4 DMA 发送</span></pre></td></tr><tr><td data-num="887"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="888"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_UARTx4_DMA_TX == 1)</span></span></pre></td></tr><tr><td data-num="889"></td><td><pre>        </pre></td></tr><tr><td data-num="890"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>STM32F103xxxx_UARTx4_DMA_RX <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="891"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="892"></td><td><pre>            <span class="token function">USART_DMACmd</span><span class="token punctuation">(</span>UART4<span class="token punctuation">,</span> USART_DMAReq_Rx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 启用 UARTx4 DMA 接收</span></pre></td></tr><tr><td data-num="893"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="894"></td><td><pre>        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_UARTx4_DMA_RX == 1)</span></span></pre></td></tr><tr><td data-num="895"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="896"></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  <span class="token comment">// #if (STM32F103xxxx_UARTx4 == 1)</span></span></pre></td></tr><tr><td data-num="897"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="stm32f103xxxx_usarth"><a class="anchor" href="#stm32f103xxxx_usarth">#</a> STM32F103xxxx_USART.H</h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">//  文件名称: STM32F103xxxx_USART.H</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">//  文件功能: USART-USART 通信总线</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//  文件说明：无</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//==================================================================================================</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__STM32F103xxxx_USART_H__</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">__STM32F103xxxx_USART_H__</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">//  包含的头文件    |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32f10x_usart.h"</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">// 宏自定义声明     |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">//  兼容 STM32 系列单片机 GPIO 端口宏定义</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">USARTx1                             USART1</span></span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">USARTx2                             USART2</span></span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">USARTx3                             USART3</span></span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">UARTx4                              UART4</span></span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">UARTx5                              UART5</span></span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx1                       <span class="token number">1</span>       </span><span class="token comment">// USARTx1 开关开启  取值范围 - 0 为禁用 1 为启用  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx1_BAUD                  <span class="token number">115200</span>  </span><span class="token comment">// USARTx1 波特率  取值范围 - 600/1200/2400/4800/9600/19200/38400/115200</span></span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx1_PORT_A09A10           <span class="token number">1</span>       </span><span class="token comment">// USARTx1 引脚设置 PA9 - TxD PA10 - RxD  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx1_PORT_B06B07           <span class="token number">0</span>       </span><span class="token comment">// USARTx1 引脚设置 PB6 - TxD PB7 - RxD  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx1_ITEN_RXNE             <span class="token number">0</span>       </span><span class="token comment">// USARTx1 接受中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx1_ITEN_IDLE             <span class="token number">0</span>       </span><span class="token comment">// USARTx1 空闲中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx1_ITEN_TC               <span class="token number">0</span>       </span><span class="token comment">// USARTx1 发送完成中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx1_DMA_TX                <span class="token number">0</span>       </span><span class="token comment">// USARTx1 DMA 发送 开关  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx1_DMA_RX                <span class="token number">0</span>       </span><span class="token comment">// USARTx1 DMA 接受 开关  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx1_DMA_TX_CUNT           <span class="token number">1024</span>    </span><span class="token comment">// USARTx1 DMA 发送 字节数量</span></span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx1_DMA_RX_CUNT           <span class="token number">1024</span>    </span><span class="token comment">// USARTx1 DMA 接受 字节数量</span></span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx2                       <span class="token number">0</span>       </span><span class="token comment">// USARTx2 开关开启  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx2_BAUD                  <span class="token number">9600</span>    </span><span class="token comment">// USARTx2 波特率  取值范围 - 600/1200/2400/4800/9600/19200/38400/115200</span></span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx2_PORT_A02A03           <span class="token number">1</span>       </span><span class="token comment">// USARTx2 引脚设置 PA2 - TxD PA3 - RxD  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx2_PORT_D05D06           <span class="token number">0</span>       </span><span class="token comment">// USARTx2 引脚设置 PD5 - TxD PD6 - RxD  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx2_ITEN_RXNE             <span class="token number">0</span>       </span><span class="token comment">// USARTx2 接受中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx2_ITEN_IDLE             <span class="token number">0</span>       </span><span class="token comment">// USARTx2 空闲中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx2_ITEN_TC               <span class="token number">0</span>       </span><span class="token comment">// USARTx2 发送完成中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx3                       <span class="token number">0</span>       </span><span class="token comment">// USARTx3 开关开启  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx3_BAUD                  <span class="token number">115200</span>  </span><span class="token comment">// USARTx3 波特率  取值范围 - 600/1200/2400/4800/9600/19200/38400/115200</span></span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx3_PORT_B10B11           <span class="token number">1</span>       </span><span class="token comment">// USARTx3 引脚设置 PB10 - TxD PB11 - RxD  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx3_PORT_C10C11           <span class="token number">0</span>       </span><span class="token comment">// USARTx3 引脚设置 PC10 - TxD PC11 - RxD  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx3_PORT_D08D09           <span class="token number">0</span>       </span><span class="token comment">// USARTx3 引脚设置 PD8 - TxD PD9 - RxD  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx3_ITEN_RXNE             <span class="token number">0</span>       </span><span class="token comment">// USARTx3 接受中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx3_ITEN_IDLE             <span class="token number">0</span>       </span><span class="token comment">// USARTx3 空闲中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx3_ITEN_TC               <span class="token number">0</span>       </span><span class="token comment">// USARTx3 发送完成中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx3_DMA_TX                <span class="token number">0</span>       </span><span class="token comment">// USARTx3 DMA 发送 开关开启  取值范围 - 0 为禁用 1 为使能</span></span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx3_DMA_RX                <span class="token number">0</span>       </span><span class="token comment">// USARTx3 DMA 接受 开关开启  取值范围 - 0 为禁用 1 为使能</span></span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx3_DMA_TX_COUNT          <span class="token number">1024</span>    </span><span class="token comment">// USARTx3 DMA 发送 字节数量</span></span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_USARTx3_DMA_RX_COUNT          <span class="token number">1024</span>    </span><span class="token comment">// USARTx3 DMA 接受 字节数量</span></span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_UARTx4                        <span class="token number">0</span>       </span><span class="token comment">// UARTx4 开关开启  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_UARTx4_BAUD                   <span class="token number">115200</span>  </span><span class="token comment">// UARTx4 波特率  取值范围 - 600/1200/2400/4800/9600/19200/38400/115200</span></span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_UARTx4_PORT_C10C11            <span class="token number">1</span>       </span><span class="token comment">// UARTx4 引脚设置 PC10 - TxD PC11 - RxD  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_UARTx4_ITEN_RXNE              <span class="token number">1</span>       </span><span class="token comment">// UARTx4 接受中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_UARTx4_ITEN_IDLE              <span class="token number">0</span>       </span><span class="token comment">// UARTx4 空闲中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_UARTx4_ITEN_TC                <span class="token number">0</span>       </span><span class="token comment">// UARTx4 发送完成中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_UARTx5                        <span class="token number">0</span>       </span><span class="token comment">// UARTx5 开关开启  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_UARTx5_BAUD                   <span class="token number">115200</span>  </span><span class="token comment">// UARTx5 波特率  取值范围 - 600/1200/2400/4800/9600/19200/38400/115200</span></span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_UARTx5_PORT_C12D02            <span class="token number">1</span>       </span><span class="token comment">// UARTx5 引脚设置 PC10 - TxD PC11 - RxD  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_UARTx5_ITEN_RXNE              <span class="token number">1</span>       </span><span class="token comment">// UARTx5 接受中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_UARTx5_ITEN_IDLE              <span class="token number">0</span>       </span><span class="token comment">// UARTx5 空闲中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">STM32F103xxxx_UARTx5_ITEN_TC                <span class="token number">0</span>       </span><span class="token comment">// UARTx5 发送完成中断操作使能  取值范围 - 0 为禁用 1 为启用</span></span></pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token comment">//  数据变量定义    |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token comment">//  函数调用声明    |   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   </span></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token comment">//--------------------------------------------------------------------------------------------------</span></pre></td></tr><tr><td data-num="80"></td><td><pre><span class="token comment">//  USART 预配置</span></pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_Configure</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token comment">//  USART 发送字符、字符串</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendChar</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Char<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendString</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre></pre></td></tr><tr><td data-num="87"></td><td><pre><span class="token comment">//  USART 接受字符</span></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">USART_ReceiveChar</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token comment">//  USART 发送数组 </span></pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendArray</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>Array<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre></pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token comment">//  USART 发送回车换行</span></pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendLine</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="95"></td><td><pre></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token comment">//  USART 发送数字 </span></pre></td></tr><tr><td data-num="97"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendNumber_SignedInteger</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">signed</span> <span class="token keyword">short</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendNumber_UnsignedInteger</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendNumber_Float</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">float</span> Number<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="100"></td><td><pre><span class="token keyword">void</span> <span class="token function">USART_SendNumber_Binary</span><span class="token punctuation">(</span>USART_TypeDef<span class="token operator">*</span> USARTx<span class="token punctuation">,</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>                                                    </pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// #ifndef __STM32F103xxxx_USART_H__</span></span></pre></td></tr></table></figure><h3 id="bsp_testc"><a class="anchor" href="#bsp_testc">#</a> BSP_TEST.C</h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_test.h"</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  * @brief  TFT_LCD_TEST LCD 测试函数</pre></td></tr><tr><td data-num="5"></td><td><pre>  * @param  none</pre></td></tr><tr><td data-num="6"></td><td><pre>  * @retval 无</pre></td></tr><tr><td data-num="7"></td><td><pre> */</pre></td></tr><tr><td data-num="8"></td><td><pre>  </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">void</span>  <span class="token function">TFT_LCD_TEST</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  </pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token function">LCD_SetFont</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Font8x16<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token function">LCD_SetColors</span><span class="token punctuation">(</span>RED<span class="token punctuation">,</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token function">ILI9341_Clear</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>LCD_X_LENGTH<span class="token punctuation">,</span>LCD_Y_LENGTH<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">/* 清屏，显示全黑 */</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token comment">/******** 显示字符串示例 *******/</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token function">ILI9341_DispStringLine_EN</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"dele 3.2 inch LCD:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token function">ILI9341_DispStringLine_EN</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"Image resolution:240x320"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token function">ILI9341_DispStringLine_EN</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"ILI9341 TFT_LCD_TEST driver "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token function">ILI9341_DispStringLine_EN</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"www.delehub.top By wangzixuan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token function">ILI9341_DispStringLine_EN</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"2020-10-02 17:15 TFT_LCD_TEST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  </pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token function">LCD_SetFont</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Font8x16<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token comment">/* 画圆 */</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  </pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token function">LCD_ClearLine</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">/* 清除单行文字 */</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	<span class="token function">LCD_SetTextColor</span><span class="token punctuation">(</span>GREEN<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	</pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token function">ILI9341_DispStringLine_EN</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"TFT_LCD_DrawCir_TEST :"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token function">LCD_SetTextColor</span><span class="token punctuation">(</span>RED<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token function">ILI9341_DrawCircle</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	</pre></td></tr><tr><td data-num="35"></td><td><pre>	<span class="token function">LCD_SetTextColor</span><span class="token punctuation">(</span>GREEN<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token function">ILI9341_DrawCircle</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	</pre></td></tr><tr><td data-num="38"></td><td><pre>	<span class="token function">LCD_SetTextColor</span><span class="token punctuation">(</span>BLUE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>	<span class="token function">ILI9341_DrawCircle</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">180</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>  <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">0xFFFFFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  </pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token function">ILI9341_Clear</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">,</span>LCD_X_LENGTH<span class="token punctuation">,</span>LCD_Y_LENGTH<span class="token operator">-</span><span class="token number">16</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">/* 清屏，显示全黑 */</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token keyword">void</span> <span class="token function">Usart_test</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  <span class="token function">USART_SendString</span><span class="token punctuation">(</span>USART1 <span class="token punctuation">,</span> <span class="token string">"2020-10-02 18:00 USART1 Test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>  <span class="token function">USART_SendLine</span><span class="token punctuation">(</span>USART1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>  <span class="token function">USART_SendNumber_SignedInteger</span><span class="token punctuation">(</span>USART1<span class="token punctuation">,</span><span class="token number">1234</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>  <span class="token function">USART_SendLine</span><span class="token punctuation">(</span>USART1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>  <span class="token function">USART_SendNumber_UnsignedInteger</span><span class="token punctuation">(</span>USART1<span class="token punctuation">,</span><span class="token number">12445</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>  <span class="token function">USART_SendLine</span><span class="token punctuation">(</span>USART1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>  <span class="token function">USART_SendNumber_Float</span><span class="token punctuation">(</span>USART1<span class="token punctuation">,</span><span class="token number">1234.89</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>  <span class="token function">USART_SendLine</span><span class="token punctuation">(</span>USART1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>  <span class="token function">USART_SendString</span><span class="token punctuation">(</span>USART1 <span class="token punctuation">,</span> <span class="token string">"www.delehub.top  By wang zi xuan "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>  <span class="token function">USART_SendLine</span><span class="token punctuation">(</span>USART1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="62"></td><td><pre>  * @brief  简单延时函数</pre></td></tr><tr><td data-num="63"></td><td><pre>  * @param  nCount ：延时计数值</pre></td></tr><tr><td data-num="64"></td><td><pre>  * @retval 无</pre></td></tr><tr><td data-num="65"></td><td><pre>  */	</pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Delay</span> <span class="token punctuation">(</span> __IO uint32_t nCount <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>  <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token punctuation">;</span> nCount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span> nCount <span class="token operator">--</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>	</pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="mainc"><a class="anchor" href="#mainc">#</a> MAIN.C</h2><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  ******************************************************************************</pre></td></tr><tr><td data-num="3"></td><td><pre>  * @file    main.c</pre></td></tr><tr><td data-num="4"></td><td><pre>  * 实验平台：野火 F103 - 霸道 STM32 开发板 </pre></td></tr><tr><td data-num="5"></td><td><pre>  ******************************************************************************</pre></td></tr><tr><td data-num="6"></td><td><pre>  * 第三方库文件导入  START THE FILE</pre></td></tr><tr><td data-num="7"></td><td><pre>  ******************************************************************************</pre></td></tr><tr><td data-num="8"></td><td><pre>  */ </pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32f10x.h"</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_led.h"</span>  </span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_key.h"</span> </span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_beep.h"</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_exit.h"</span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"timer.h"</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_ili9341_lcd.h"</span></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_SysTick.h"</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_usart.h"</span></span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_test.h"</span></span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"STM32F103xxxx_USART.H"</span>  </span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">/******************************************************************************</span></pre></td></tr><tr><td data-num="23"></td><td><pre>END THE FILE</pre></td></tr><tr><td data-num="24"></td><td><pre>  * 第三方库文件导入 *********************************************************/ </pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">void</span> <span class="token function">HardWare_Iint</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token function">NVIC_PriorityGroupConfig</span><span class="token punctuation">(</span>NVIC_PriorityGroup_2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token function">LED_Iint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token function">Key_Iint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token function">Beep_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token comment">//TIM4_Int_Init(9999,7199);</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token function">ILI9341_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token function">USART_Configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  </pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  * @brief  主函数</pre></td></tr><tr><td data-num="39"></td><td><pre>  * @param  无</pre></td></tr><tr><td data-num="40"></td><td><pre>  * @retval 无</pre></td></tr><tr><td data-num="41"></td><td><pre>  */ </pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">&#123;</span>	</pre></td></tr><tr><td data-num="44"></td><td><pre>	<span class="token comment">/* 硬件端口初始化 */</span></pre></td></tr><tr><td data-num="45"></td><td><pre>	<span class="token function">HardWare_Iint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>  	<span class="token function">ILI9341_GramScan</span> <span class="token punctuation">(</span> <span class="token number">6</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>  	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>  	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>	    <span class="token function">TFT_LCD_TEST</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>	    <span class="token function">Usart_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre> 	<span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="串口助手打印效果"><a class="anchor" href="#串口助手打印效果">#</a> 串口助手打印效果</h3><p><img data-src="https://img-blog.csdnimg.cn/20201002210122772.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt="串口助手打印效果"></p><h3 id="tft_lcd-测试效果"><a class="anchor" href="#tft_lcd-测试效果">#</a> TFT_LCD 测试效果</h3><p><img data-src="https://img-blog.csdnimg.cn/20201002210353427.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt="TFT_LCD 测试效果"></p><h1 id="野火f1开发板stm32案例-外部中断按键使用"><a class="anchor" href="#野火f1开发板stm32案例-外部中断按键使用">#</a> 野火 F1 开发板 STM32 案例 - 外部中断 (按键) 使用</h1><h2 id="硬件平台-2"><a class="anchor" href="#硬件平台-2">#</a> 硬件平台</h2><ol><li>野火 STM32F103ZET6 霸道 V2 开发板</li><li>正点原子 F1 系列开发板<br><img data-src="https://img-blog.csdnimg.cn/20201002210908329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt="STM32产品"></li></ol><h2 id="软件平台-2"><a class="anchor" href="#软件平台-2">#</a> 软件平台</h2><ol><li>Keil MDK 5.31</li><li>串口调试助手</li></ol><p>工程下载<span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC5jc2RuLm5ldC9kb3dubG9hZC93ZWl4aW5fNDM1OTkzOTAvMTI5MTAzOTc="> https://download.csdn.net/download/weixin_43599390/12910397</span></p><h2 id="中断相关概念"><a class="anchor" href="#中断相关概念">#</a> 中断相关概念</h2><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>中断配置寄存器</pre></td></tr><tr><td data-num="2"></td><td><pre># 配置中断时，使用ISER、 ICER 和 IP 寄存器，</pre></td></tr><tr><td data-num="3"></td><td><pre>## ISER 是中断使能寄存器</pre></td></tr><tr><td data-num="4"></td><td><pre>## ICER 是中断清除寄存器</pre></td></tr><tr><td data-num="5"></td><td><pre>## IP 是中断优先级寄存器</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>中断优先级</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">1.</span> 数值越小，优先级越高</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">2.</span> STM32F103 中只使用<span class="token number">4</span>位，高<span class="token number">4</span>位有效。</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">3.</span> 用于表达优先级的高 <span class="token number">4</span> 位又被分组成抢占式优先级和响应优先级，称为“亚优先级”或“副优先级”</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">4.</span> 每个中断源都需要被指定这两种优先级。</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>中断配置步骤</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">1.</span>使能外设中断</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">6.</span> 设置中断优先级分组</pre></td></tr><tr><td data-num="16"></td><td><pre>初始化 NVIC_InitTypeDef 结构体，设置抢占优先级和响应优先级，使能中断请求。</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>     uint8_t NVIC_IRQChannel<span class="token punctuation">;</span> <span class="token comment">// 中断源</span></pre></td></tr><tr><td data-num="20"></td><td><pre>     uint8_t NVIC_IRQChannelPreemptionPriority<span class="token punctuation">;</span> <span class="token comment">// 抢占优先级</span></pre></td></tr><tr><td data-num="21"></td><td><pre>     uint8_t NVIC_IRQChannelSubPriority<span class="token punctuation">;</span> <span class="token comment">// 响应优先级</span></pre></td></tr><tr><td data-num="22"></td><td><pre>     FunctionalState NVIC_IRQChannelCmd<span class="token punctuation">;</span> <span class="token comment">// 中断使能或失能</span></pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token punctuation">&#125;</span> NVIC_InitTypeDef<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>NVIC_IRQChannel 中断源<span class="token operator">:</span>中断源的设置，不同的外设中断，中断源不一样</pre></td></tr><tr><td data-num="27"></td><td><pre>NVIC_IRQChannelPreemptionPriority  <span class="token comment">// 抢占优先级</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>NVIC_IRQChannelSubPriority  <span class="token comment">// 响应优先级</span></pre></td></tr><tr><td data-num="30"></td><td><pre>NVIC_IRQChannelCmd <span class="token comment">// 中断使能或失能：使能配置为 ENABLE，失能配置为 DISABLE。</span></pre></td></tr></table></figure><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>NVIC_IRQChannel   <span class="token comment">// 中断源</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/******  Cortex-M3 Processor Exceptions Numbers ***************************************************/</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  NonMaskableInt_IRQn         <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">14</span><span class="token punctuation">,</span>    <span class="token comment">/*!&lt; 2 Non Maskable Interrupt                             */</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  MemoryManagement_IRQn       <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span>    <span class="token comment">/*!&lt; 4 Cortex-M3 Memory Management Interrupt              */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  BusFault_IRQn               <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span>    <span class="token comment">/*!&lt; 5 Cortex-M3 Bus Fault Interrupt                      */</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  UsageFault_IRQn             <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>    <span class="token comment">/*!&lt; 6 Cortex-M3 Usage Fault Interrupt                    */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  SVCall_IRQn                 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span>     <span class="token comment">/*!&lt; 11 Cortex-M3 SV Call Interrupt                       */</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  DebugMonitor_IRQn           <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span>     <span class="token comment">/*!&lt; 12 Cortex-M3 Debug Monitor Interrupt                 */</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  PendSV_IRQn                 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>     <span class="token comment">/*!&lt; 14 Cortex-M3 Pend SV Interrupt                       */</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  SysTick_IRQn                <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>     <span class="token comment">/*!&lt; 15 Cortex-M3 System Tick Interrupt                   */</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">/******  STM32 specific Interrupt Numbers *********************************************************/</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  WWDG_IRQn                   <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token comment">/*!&lt; Window WatchDog Interrupt                            */</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  PVD_IRQn                    <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>      <span class="token comment">/*!&lt; PVD through EXTI Line detection Interrupt            */</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  TAMPER_IRQn                 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>      <span class="token comment">/*!&lt; Tamper Interrupt                                     */</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  RTC_IRQn                    <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>      <span class="token comment">/*!&lt; RTC global Interrupt                                 */</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  FLASH_IRQn                  <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>      <span class="token comment">/*!&lt; FLASH global Interrupt                               */</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  RCC_IRQn                    <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>      <span class="token comment">/*!&lt; RCC global Interrupt                                 */</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  EXTI0_IRQn                  <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>      <span class="token comment">/*!&lt; EXTI Line0 Interrupt                                 */</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  EXTI1_IRQn                  <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span>      <span class="token comment">/*!&lt; EXTI Line1 Interrupt                                 */</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  EXTI2_IRQn                  <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span>      <span class="token comment">/*!&lt; EXTI Line2 Interrupt                                 */</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  EXTI3_IRQn                  <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span>      <span class="token comment">/*!&lt; EXTI Line3 Interrupt                                 */</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  EXTI4_IRQn                  <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>     <span class="token comment">/*!&lt; EXTI Line4 Interrupt                                 */</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  DMA1_Channel1_IRQn          <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">,</span>     <span class="token comment">/*!&lt; DMA1 Channel 1 global Interrupt                      */</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  DMA1_Channel2_IRQn          <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">,</span>     <span class="token comment">/*!&lt; DMA1 Channel 2 global Interrupt                      */</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  DMA1_Channel3_IRQn          <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">,</span>     <span class="token comment">/*!&lt; DMA1 Channel 3 global Interrupt                      */</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  DMA1_Channel4_IRQn          <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">,</span>     <span class="token comment">/*!&lt; DMA1 Channel 4 global Interrupt                      */</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  DMA1_Channel5_IRQn          <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">,</span>     <span class="token comment">/*!&lt; DMA1 Channel 5 global Interrupt                      */</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  DMA1_Channel6_IRQn          <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span>     <span class="token comment">/*!&lt; DMA1 Channel 6 global Interrupt                      */</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  DMA1_Channel7_IRQn          <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span>     <span class="token comment">/*!&lt; DMA1 Channel 7 global Interrupt                      */</span></pre></td></tr></table></figure><h3 id="stm32f103-中断向量表"><a class="anchor" href="#stm32f103-中断向量表">#</a> STM32F103 中断向量表</h3><p><img data-src="https://img-blog.csdnimg.cn/2020100315141155.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt=" 中断向量表1"><br><img data-src="https://img-blog.csdnimg.cn/20201003151410982.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt=" 中断向量表2"></p><h3 id="exti外部中断"><a class="anchor" href="#exti外部中断">#</a> EXTI 外部中断</h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">1.</span> STM32F10x 外部中断<span class="token operator">/</span>事件控制器（EXTI）包含多达 <span class="token number">20</span> 个用于产生事件<span class="token operator">/</span>中断请求的边沿检测器。</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2.</span> EXTI 的每根输入线都可单独进行配置，以选择类型（中断或事件）和相应的触发事件（上升沿触发、下降沿触发或边沿触发）</pre></td></tr><tr><td data-num="3"></td><td><pre>还可独立地被屏蔽。</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">3.</span> EXIT功能<span class="token operator">:</span>产生中断<span class="token punctuation">;</span>产生事件<span class="token punctuation">.</span></pre></td></tr></table></figure><h3 id="stm32-exit框架图"><a class="anchor" href="#stm32-exit框架图">#</a> STM32 EXIT 框架图</h3><p><img data-src="https://img-blog.csdnimg.cn/20201003151626597.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt="STM32 EXIT框架图"></p><h2 id="exti外部中断步骤"><a class="anchor" href="#exti外部中断步骤">#</a> EXTI 外部中断步骤</h2><ol><li>使能 I0 口时钟，配置 I0 口模式为输入</li><li>开启 AFIO 时钟，设置 I0 口与中断线的映射关系</li><li>配置中断分组（NVIC），使能中断</li><li>初始化 EXTI，选择触发方式</li><li>编写 EXTI 中断服务函数</li></ol><h4 id="gpio引脚配置本文中和外部中断bsp_exith一起进行初始化可以分开进行配置相关函数"><a class="anchor" href="#gpio引脚配置本文中和外部中断bsp_exith一起进行初始化可以分开进行配置相关函数">#</a> GPIO 引脚配置（本文中和外部中断 bsp_exit.h 一起进行初始化，可以分开进行配置相关函数）</h4><p>(一般配置过程类似，无论使用什么外设，UART,IIC,SPI,ADC 一般情况都要 GPIO 初始化)</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 定义 GPIO 初始化结构体</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 使能 GPIO 时钟 (时钟分频)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 设置相关外部设备的对应引脚</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 设置 GPIO 端口模式 (GPIO 输入 GPIO 输出)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 设置生效 (GPIO 端口启动生效)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">GPIO输入模式</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">void</span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	GPIO_InitTypeDef GPIO_InitStructure<span class="token punctuation">;</span>                  <span class="token comment">// 定义 GPIO 初始化结构体</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOA<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使能 GPIO 时钟 (时钟分频)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> KEY_UP_PIN<span class="token operator">|</span>KEY_DOWN_PIN<span class="token punctuation">;</span><span class="token comment">// 设置相关外部设备的对应引脚</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_IPU<span class="token punctuation">;</span>         <span class="token comment">// 设置上拉输入 // 设置 GPIO 端口模式</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>			      <span class="token comment">// 设置生效 (GPIO 端口启动生效)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">GPIO输出模式</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">void</span> <span class="token function">initLED</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	GPIO_InitTypeDef GPIO_InitStructure<span class="token punctuation">;</span>                  <span class="token comment">// 定义 GPIO 初始化结构体</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOB<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使能 GPIO 时钟</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> GPIO_Pin_5<span class="token punctuation">;</span>		      <span class="token comment">// 设置对应引脚</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_Out_PP<span class="token punctuation">;</span>      <span class="token comment">// 设置推挽输出</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>     <span class="token comment">// 工作速度 50MHz</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 设置生效</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token function">GPIO_ResetBits</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span> GPIO_Pin_5<span class="token punctuation">)</span><span class="token punctuation">;</span>				      <span class="token comment">// 默认低电平，LED 不</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="配置嵌套向量中断控制器nvic步骤"><a class="anchor" href="#配置嵌套向量中断控制器nvic步骤">#</a> 配置嵌套向量中断控制器 NVIC 步骤</h4><ol><li>定义 NVIC 结构体 NVIC_InitTypeDef 结构体</li></ol><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	uint8_t NVIC_IRQChannel<span class="token punctuation">;</span> <span class="token comment">// 中断源</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	uint8_t NVIC_IRQChannelPreemptionPriority<span class="token punctuation">;</span> <span class="token comment">// 抢占优先级</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	uint8_t NVIC_IRQChannelSubPriority<span class="token punctuation">;</span> <span class="token comment">// 响应优先级</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	FunctionalState NVIC_IRQChannelCmd<span class="token punctuation">;</span> <span class="token comment">// 中断使能或失能</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span> NVIC_InitTypeDef<span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="2"><li>配置 NVIC 为优先级组<br><img data-src="https://img-blog.csdnimg.cn/20201003160403277.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt="优先级组"></li></ol><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">NVIC_PriorityGroupConfig</span><span class="token punctuation">(</span>NVIC_PriorityGroup_1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="3"><li>配置中断源</li></ol><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannel <span class="token operator">=</span> KEY1_INT_EXTI_IRQ<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// #define KEY1_INT_EXTI_PORTSOURCE   GPIO_PortSourceGPIOA</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// #define KEY1_INT_EXTI_PINSOURCE    GPIO_PinSource0</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// #define KEY1_INT_EXTI_LINE         EXTI_Line0</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// #define KEY1_INT_EXTI_IRQ          EXTI0_IRQn</span></pre></td></tr></table></figure><ol start="4"><li>配置抢占优先级</li></ol><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelPreemptionPriority <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="5"><li>配置子优先级</li></ol><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelSubPriority <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="6"><li>使能中断通道</li></ol><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelCmd <span class="token operator">=</span> ENABLE<span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="7"><li>初始化 NVIC</li></ol><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">NVIC_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>NVIC_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="配置-exti中断口并设置中断优先级步骤流程"><a class="anchor" href="#配置-exti中断口并设置中断优先级步骤流程">#</a> 配置 EXTI 中断口，并设置中断优先级步骤流程</h4><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">1.</span> 定义GPIO_InitTypeDef EXTI_InitTypeDef 结构体</pre></td></tr><tr><td data-num="2"></td><td><pre>GPIO_InitTypeDef GPIO_InitStructure<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>EXTI_InitTypeDef EXTI_InitStructure<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  uint16_t GPIO_Pin<span class="token punctuation">;</span>             <span class="token comment">/*!&lt; Specifies the GPIO pins to be configured.</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                                      This parameter can be any value of @ref GPIO_pins_define */</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>  GPIOSpeed_TypeDef GPIO_Speed<span class="token punctuation">;</span>  <span class="token comment">/*!&lt; Specifies the speed for the selected pins.</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                                      This parameter can be a value of @ref GPIOSpeed_TypeDef */</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>  GPIOMode_TypeDef GPIO_Mode<span class="token punctuation">;</span>    <span class="token comment">/*!&lt; Specifies the operating mode for the selected pins.</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                                      This parameter can be a value of @ref GPIOMode_TypeDef */</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span>GPIO_InitTypeDef<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  uint32_t EXTI_Line<span class="token punctuation">;</span>               <span class="token comment">/*!&lt; Specifies the EXTI lines to be enabled or disabled.</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                                         This parameter can be any combination of @ref EXTI_Lines */</pre></td></tr><tr><td data-num="21"></td><td><pre>   </pre></td></tr><tr><td data-num="22"></td><td><pre>  EXTIMode_TypeDef EXTI_Mode<span class="token punctuation">;</span>       <span class="token comment">/*!&lt; Specifies the mode for the EXTI lines.</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                                         This parameter can be a value of @ref EXTIMode_TypeDef */</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>  EXTITrigger_TypeDef EXTI_Trigger<span class="token punctuation">;</span> <span class="token comment">/*!&lt; Specifies the trigger signal active edge for the EXTI lines.</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                                         This parameter can be a value of @ref EXTIMode_TypeDef */</pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>  FunctionalState EXTI_LineCmd<span class="token punctuation">;</span>     <span class="token comment">/*!&lt; Specifies the new state of the selected EXTI lines.</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                                         This parameter can be set either to ENABLE or DISABLE */ </pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span>EXTI_InitTypeDef<span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="https://img-blog.csdnimg.cn/20201003162222876.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt="GPIO结构体"><br><img data-src="https://img-blog.csdnimg.cn/20201003162222867.png#pic_center" alt="中断事件结构体"></p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/* 开启按键 GPIO 口的时钟 */</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>KEY1_INT_GPIO_CLK<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">/* 配置 NVIC 中断 */</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">NVIC_Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h5 id="gpio引脚配置"><a class="anchor" href="#gpio引脚配置">#</a> GPIO 引脚配置</h5><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/*--------------------------KEY1 配置 -------------------------*/</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/* 选择按键用到的 GPIO */</span>	</pre></td></tr><tr><td data-num="3"></td><td><pre>  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> KEY1_INT_GPIO_PIN<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token comment">/* 配置为浮空输入 */</span>	</pre></td></tr><tr><td data-num="5"></td><td><pre>  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>KEY1_INT_GPIO_PORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">/*------------------------KEY2 配置 -----------------------------*/</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">/* 选择按键用到的 GPIO */</span>	</pre></td></tr><tr><td data-num="9"></td><td><pre>  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> KEY2_INT_GPIO_PIN<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token comment">/* 配置为浮空输入 */</span>	</pre></td></tr><tr><td data-num="11"></td><td><pre>  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>KEY2_INT_GPIO_PORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h5 id="中断配置"><a class="anchor" href="#中断配置">#</a> 中断配置</h5><ol><li>中断信号源</li><li>EXIT 模式</li><li>外部中断触发类型</li><li>使能中断 EXIT</li><li>中断初始化</li></ol><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/* 选择 EXTI 的信号源 */</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token function">GPIO_EXTILineConfig</span><span class="token punctuation">(</span>KEY1_INT_EXTI_PORTSOURCE<span class="token punctuation">,</span> KEY1_INT_EXTI_PINSOURCE<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>  EXTI_InitStructure<span class="token punctuation">.</span>EXTI_Line <span class="token operator">=</span> KEY1_INT_EXTI_LINE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token comment">/* EXTI 为中断模式 */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  EXTI_InitStructure<span class="token punctuation">.</span>EXTI_Mode <span class="token operator">=</span> EXTI_Mode_Interrupt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token comment">/* 上升沿中断 */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  EXTI_InitStructure<span class="token punctuation">.</span>EXTI_Trigger <span class="token operator">=</span> EXTI_Trigger_Rising<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">/* 使能中断 */</span>	</pre></td></tr><tr><td data-num="9"></td><td><pre>  EXTI_InitStructure<span class="token punctuation">.</span>EXTI_LineCmd <span class="token operator">=</span> ENABLE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">EXTI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>EXTI_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="bsp_exith"><a class="anchor" href="#bsp_exith">#</a> BSP_EXIT.H</h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 引脚定义</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY1_INT_GPIO_PORT         GPIOA</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">KEY1_INT_GPIO_CLK</span>          <span class="token punctuation">(</span>RCC_APB2Periph_GPIOA<span class="token operator">|</span>RCC_APB2Periph_AFIO<span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY1_INT_GPIO_PIN          GPIO_Pin_0</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY1_INT_EXTI_PORTSOURCE   GPIO_PortSourceGPIOA</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY1_INT_EXTI_PINSOURCE    GPIO_PinSource0</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY1_INT_EXTI_LINE         EXTI_Line0</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY1_INT_EXTI_IRQ          EXTI0_IRQn</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY1_IRQHandler            EXTI0_IRQHandler</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY2_INT_GPIO_PORT         GPIOC</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">KEY2_INT_GPIO_CLK</span>          <span class="token punctuation">(</span>RCC_APB2Periph_GPIOC<span class="token operator">|</span>RCC_APB2Periph_AFIO<span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY2_INT_GPIO_PIN          GPIO_Pin_13</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY2_INT_EXTI_PORTSOURCE   GPIO_PortSourceGPIOC</span></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY2_INT_EXTI_PINSOURCE    GPIO_PinSource13</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY2_INT_EXTI_LINE         EXTI_Line13</span></span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY2_INT_EXTI_IRQ          EXTI15_10_IRQn</span></span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">KEY2_IRQHandler            EXTI15_10_IRQHandler</span></span></pre></td></tr></table></figure><h3 id="bsp_exitc"><a class="anchor" href="#bsp_exitc">#</a> BSP_EXIT.C</h3><h4 id="配置嵌套向量中断控制器nvic"><a class="anchor" href="#配置嵌套向量中断控制器nvic">#</a> 配置嵌套向量中断控制器 NVIC</h4><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token expression">“bsp_exit<span class="token punctuation">.</span>h”</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  * @brief  配置嵌套向量中断控制器 NVIC</pre></td></tr><tr><td data-num="4"></td><td><pre>  * @param  无</pre></td></tr><tr><td data-num="5"></td><td><pre>  * @retval 无</pre></td></tr><tr><td data-num="6"></td><td><pre>  */</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">NVIC_Configuration</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  NVIC_InitTypeDef NVIC_InitStructure<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  </pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token comment">/* 配置 NVIC 为优先级组 1 */</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">NVIC_PriorityGroupConfig</span><span class="token punctuation">(</span>NVIC_PriorityGroup_1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  </pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token comment">/* 配置中断源：按键 1 */</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannel <span class="token operator">=</span> KEY1_INT_EXTI_IRQ<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token comment">/* 配置抢占优先级 */</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelPreemptionPriority <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token comment">/* 配置子优先级 */</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelSubPriority <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token comment">/* 使能中断通道 */</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelCmd <span class="token operator">=</span> ENABLE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token function">NVIC_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>NVIC_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  </pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token comment">/* 配置中断源：按键 2，其他使用上面相关配置 */</span>  </pre></td></tr><tr><td data-num="25"></td><td><pre>  NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannel <span class="token operator">=</span> KEY2_INT_EXTI_IRQ<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token function">NVIC_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>NVIC_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="配置-io为exti中断口并设置中断优先级"><a class="anchor" href="#配置-io为exti中断口并设置中断优先级">#</a> 配置 IO 为 EXTI 中断口，并设置中断优先级</h4><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">EXTI_Key_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	GPIO_InitTypeDef GPIO_InitStructure<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre>	EXTI_InitTypeDef EXTI_InitStructure<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token comment">/* 开启按键 GPIO 口的时钟 */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>KEY1_INT_GPIO_CLK<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>												</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token comment">/* 配置 NVIC 中断 */</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token function">NVIC_Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">/*--------------------------KEY1 配置 -----------------------------*/</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token comment">/* 选择按键用到的 GPIO */</span>	</pre></td></tr><tr><td data-num="14"></td><td><pre>  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> KEY1_INT_GPIO_PIN<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token comment">/* 配置为浮空输入 */</span>	</pre></td></tr><tr><td data-num="16"></td><td><pre>  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>KEY1_INT_GPIO_PORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token comment">/* 选择 EXTI 的信号源 */</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token function">GPIO_EXTILineConfig</span><span class="token punctuation">(</span>KEY1_INT_EXTI_PORTSOURCE<span class="token punctuation">,</span> KEY1_INT_EXTI_PINSOURCE<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre>  EXTI_InitStructure<span class="token punctuation">.</span>EXTI_Line <span class="token operator">=</span> KEY1_INT_EXTI_LINE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	</pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token comment">/* EXTI 为中断模式 */</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  EXTI_InitStructure<span class="token punctuation">.</span>EXTI_Mode <span class="token operator">=</span> EXTI_Mode_Interrupt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token comment">/* 上升沿中断 */</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  EXTI_InitStructure<span class="token punctuation">.</span>EXTI_Trigger <span class="token operator">=</span> EXTI_Trigger_Rising<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token comment">/* 使能中断 */</span>	</pre></td></tr><tr><td data-num="28"></td><td><pre>  EXTI_InitStructure<span class="token punctuation">.</span>EXTI_LineCmd <span class="token operator">=</span> ENABLE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token function">EXTI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>EXTI_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	</pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token comment">/*--------------------------KEY2 配置 -----------------------------*/</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token comment">/* 选择按键用到的 GPIO */</span>	</pre></td></tr><tr><td data-num="33"></td><td><pre>  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> KEY2_INT_GPIO_PIN<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token comment">/* 配置为浮空输入 */</span>	</pre></td></tr><tr><td data-num="35"></td><td><pre>  GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_IN_FLOATING<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>KEY2_INT_GPIO_PORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>	<span class="token comment">/* 选择 EXTI 的信号源 */</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token function">GPIO_EXTILineConfig</span><span class="token punctuation">(</span>KEY2_INT_EXTI_PORTSOURCE<span class="token punctuation">,</span> KEY2_INT_EXTI_PINSOURCE<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="40"></td><td><pre>  EXTI_InitStructure<span class="token punctuation">.</span>EXTI_Line <span class="token operator">=</span> KEY2_INT_EXTI_LINE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	</pre></td></tr><tr><td data-num="42"></td><td><pre>	<span class="token comment">/* EXTI 为中断模式 */</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  EXTI_InitStructure<span class="token punctuation">.</span>EXTI_Mode <span class="token operator">=</span> EXTI_Mode_Interrupt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>	<span class="token comment">/* 下降沿中断 */</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  EXTI_InitStructure<span class="token punctuation">.</span>EXTI_Trigger <span class="token operator">=</span> EXTI_Trigger_Falling<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>  <span class="token comment">/* 使能中断 */</span>	</pre></td></tr><tr><td data-num="47"></td><td><pre>  EXTI_InitStructure<span class="token punctuation">.</span>EXTI_LineCmd <span class="token operator">=</span> ENABLE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>  <span class="token function">EXTI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>EXTI_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="中断服务函数"><a class="anchor" href="#中断服务函数">#</a> 中断服务函数</h3><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32f10x_it.h"</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_test.h"</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="4"></td><td><pre>******************************************************************************</pre></td></tr><tr><td data-num="5"></td><td><pre>  * @file    stm32 用户自定义外部中断</pre></td></tr><tr><td data-num="6"></td><td><pre>  * @author  dele</pre></td></tr><tr><td data-num="7"></td><td><pre>  * @version V1.0</pre></td></tr><tr><td data-num="8"></td><td><pre>  * @date    2020-10-03</pre></td></tr><tr><td data-num="9"></td><td><pre>  * @brief   按键测试（中断模式 / EXTI 模式）</pre></td></tr><tr><td data-num="10"></td><td><pre>  * 实验平台：野火 F103 - 霸道 STM32 开发板 </pre></td></tr><tr><td data-num="11"></td><td><pre>  ******************************************************************************</pre></td></tr><tr><td data-num="12"></td><td><pre>  */ </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">void</span> <span class="token function">KEY1_IRQHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token comment">// 确保是否产生了 EXTI Line 中断</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">EXTI_GetITStatus</span><span class="token punctuation">(</span>KEY1_INT_EXTI_LINE<span class="token punctuation">)</span> <span class="token operator">!=</span> RESET<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token comment">// LED1 取反		</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		LED1_TOGGLE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	    <span class="token function">BSP_KEY1_EXIT_LCDTEST</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre>	    <span class="token function">USART_SendString</span><span class="token punctuation">(</span>USART1<span class="token punctuation">,</span><span class="token string">"KEY1 EXIT www.delehub.top"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	    <span class="token function">USART_SendLine</span><span class="token punctuation">(</span>USART1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// 清除中断标志位</span></pre></td></tr><tr><td data-num="24"></td><td><pre>		<span class="token function">EXTI_ClearITPendingBit</span><span class="token punctuation">(</span>KEY1_INT_EXTI_LINE<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="25"></td><td><pre>     </pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">void</span> <span class="token function">KEY2_IRQHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token comment">// 确保是否产生了 EXTI Line 中断</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">EXTI_GetITStatus</span><span class="token punctuation">(</span>KEY2_INT_EXTI_LINE<span class="token punctuation">)</span> <span class="token operator">!=</span> RESET<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>		<span class="token comment">// LED2 取反		</span></pre></td></tr><tr><td data-num="35"></td><td><pre>		LED2_TOGGLE</pre></td></tr><tr><td data-num="36"></td><td><pre>	    <span class="token function">BSP_KEY2_EXIT_LCDTEST</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="37"></td><td><pre>	    <span class="token function">USART_SendString</span><span class="token punctuation">(</span>USART1<span class="token punctuation">,</span><span class="token string">"KEY2 EXIT 2020-10-03 14:50"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="38"></td><td><pre>	    <span class="token function">USART_SendLine</span><span class="token punctuation">(</span>USART1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token comment">// 清除中断标志位</span></pre></td></tr><tr><td data-num="40"></td><td><pre>		<span class="token function">EXTI_ClearITPendingBit</span><span class="token punctuation">(</span>KEY2_INT_EXTI_LINE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>      </pre></td></tr><tr><td data-num="42"></td><td><pre>	<span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="按键外部中断测试函数"><a class="anchor" href="#按键外部中断测试函数">#</a> 按键外部中断测试函数</h4><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">BSP_KEY1_EXIT_LCDTEST</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">LCD_SetFont</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Font8x16<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token function">LCD_SetColors</span><span class="token punctuation">(</span>RED<span class="token punctuation">,</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">ILI9341_Clear</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>LCD_X_LENGTH<span class="token punctuation">,</span>LCD_Y_LENGTH<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">/* 清屏，显示全黑 */</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">ILI9341_DispStringLine_EN</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"2020-10-03 14:30 BSP_EXIT_TEST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token function">ILI9341_DispStringLine_EN</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"KEY1 EXIT TEST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">LCD_SetTextColor</span><span class="token punctuation">(</span>RED<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">ILI9341_DrawCircle</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">void</span> <span class="token function">BSP_KEY2_EXIT_LCDTEST</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token function">LCD_SetFont</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Font8x16<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token function">LCD_SetColors</span><span class="token punctuation">(</span>RED<span class="token punctuation">,</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token function">ILI9341_Clear</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>LCD_X_LENGTH<span class="token punctuation">,</span>LCD_Y_LENGTH<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">/* 清屏，显示全黑 */</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token function">ILI9341_DispStringLine_EN</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"2020-10-03 14:30 DELEHUB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token function">ILI9341_DispStringLine_EN</span><span class="token punctuation">(</span><span class="token function">LINE</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"KEY2 EXIT TEST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token function">LCD_SetTextColor</span><span class="token punctuation">(</span>GREEN<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token function">ILI9341_DrawCircle</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="mainc-2"><a class="anchor" href="#mainc-2">#</a> MAIN.C</h4><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/****************************************************************</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  * @file    main.c</pre></td></tr><tr><td data-num="3"></td><td><pre>  * 实验平台：野火 F103 - 霸道 STM32 开发板  ***************************************************************** 第三方库文件导入  START THE FILE</pre></td></tr><tr><td data-num="4"></td><td><pre> ***************************************************************/ </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32f10x.h"</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_led.h"</span>  </span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_key.h"</span> </span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_beep.h"</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_exit.h"</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"timer.h"</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_ili9341_lcd.h"</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_SysTick.h"</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_usart.h"</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_test.h"</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"STM32F103xxxx_USART.H"</span>  </span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">/******************************************************************************</span></pre></td></tr><tr><td data-num="18"></td><td><pre>END THE FILE</pre></td></tr><tr><td data-num="19"></td><td><pre>  * 第三方库文件导入 *********************************************************/ </pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">void</span> <span class="token function">HardWare_Iint</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  </pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token function">NVIC_PriorityGroupConfig</span><span class="token punctuation">(</span>NVIC_PriorityGroup_2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token function">EXTI_Key_Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token function">LED_Iint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token function">Key_Iint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token function">Beep_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token comment">//TIM4_Int_Init(9999,7199);</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token function">ILI9341_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token function">USART_Configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  </pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  * @brief  主函数</pre></td></tr><tr><td data-num="35"></td><td><pre>  * @param  无</pre></td></tr><tr><td data-num="36"></td><td><pre>  * @retval 无</pre></td></tr><tr><td data-num="37"></td><td><pre>  */ </pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#123;</span>	</pre></td></tr><tr><td data-num="40"></td><td><pre>	<span class="token comment">/* 硬件端口初始化 */</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	<span class="token function">HardWare_Iint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>	<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="串口打印效果"><a class="anchor" href="#串口打印效果">#</a> 串口打印效果</h3><p><img data-src="https://img-blog.csdnimg.cn/20201003153440133.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt="串口打印效果"></p><h3 id="tft显示效果"><a class="anchor" href="#tft显示效果">#</a> TFT 显示效果</h3><p><img data-src="https://img-blog.csdnimg.cn/20201003153501455.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt="TFT显示效果key2"><br><img data-src="https://img-blog.csdnimg.cn/20201003153501430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5OTM5MA==,size_16,color_FFFFFF,t_70#pic_center" alt="TFT显示效果key2"></p><h3 id="博客地址httpsdelehubvercelapp"><a class="anchor" href="#博客地址httpsdelehubvercelapp">#</a> 博客地址<span class="exturl" data-url="aHR0cHM6Ly9kZWxlaHViLnZlcmNlbC5hcHAv"> https://delehub.vercel.app/</span></h3></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2020-10-22 16:11:55" itemprop="dateModified" datetime="2020-10-22T16:11:55+08:00">2020-10-22</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Do 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Do 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Do 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Do <i class="ic i-at"><em>@</em></i>JieSang</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/2020/10/22/STM32%E4%BE%8B/" title="STM32例">http://example.com/2020/10/22/STM32例/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="nav"><div class="item left"><a href="/2020/10/21/%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclhpw3lwj20zk0m8gvw.jpg" title="未命名"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>未命名</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8E%E7%81%ABstm32f1%E7%B3%BB%E5%88%97%E5%BC%80%E5%8F%91%E6%9D%BF%E5%AD%A6%E4%B9%A0%E6%A1%88%E4%BE%8B"><span class="toc-number">1.</span> <span class="toc-text">野火 STM32F1 系列开发板学习案例</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%87%8E%E7%81%ABf1%E5%BC%80%E5%8F%91%E6%9D%BFstm32-usart%E4%BD%BF%E7%94%A8"><span class="toc-number"></span> <span class="toc-text">野火 F1 开发板 STM32-USART 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E5%B9%B3%E5%8F%B0"><span class="toc-number">1.</span> <span class="toc-text">硬件平台</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E5%B9%B3%E5%8F%B0"><span class="toc-number">2.</span> <span class="toc-text">软件平台</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%B2%E5%8F%A3%E9%85%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.</span> <span class="toc-text">串口配置步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E6%A8%A1%E6%9D%BF%E7%BB%93%E6%9E%84"><span class="toc-number">4.</span> <span class="toc-text">工程模板结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stm32f103zet6-%E4%B8%B2%E5%8F%A3%E5%BC%95%E8%84%9A%E5%88%97%E8%A1%A8"><span class="toc-number">5.</span> <span class="toc-text">STM32F103ZET6 串口引脚列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#stm32f103xxxx_usartc"><span class="toc-number">5.1.</span> <span class="toc-text">STM32F103xxxx_USART.C</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stm32f103xxxx_usarth"><span class="toc-number">5.2.</span> <span class="toc-text">STM32F103xxxx_USART.H</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bsp_testc"><span class="toc-number">5.3.</span> <span class="toc-text">BSP_TEST.C</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mainc"><span class="toc-number">6.</span> <span class="toc-text">MAIN.C</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B2%E5%8F%A3%E5%8A%A9%E6%89%8B%E6%89%93%E5%8D%B0%E6%95%88%E6%9E%9C"><span class="toc-number">6.1.</span> <span class="toc-text">串口助手打印效果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tft_lcd-%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C"><span class="toc-number">6.2.</span> <span class="toc-text">TFT_LCD 测试效果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%87%8E%E7%81%ABf1%E5%BC%80%E5%8F%91%E6%9D%BFstm32%E6%A1%88%E4%BE%8B-%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E6%8C%89%E9%94%AE%E4%BD%BF%E7%94%A8"><span class="toc-number"></span> <span class="toc-text">野火 F1 开发板 STM32 案例 - 外部中断 (按键) 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E5%B9%B3%E5%8F%B0-2"><span class="toc-number">1.</span> <span class="toc-text">硬件平台</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E5%B9%B3%E5%8F%B0-2"><span class="toc-number">2.</span> <span class="toc-text">软件平台</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">3.</span> <span class="toc-text">中断相关概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#stm32f103-%E4%B8%AD%E6%96%AD%E5%90%91%E9%87%8F%E8%A1%A8"><span class="toc-number">3.1.</span> <span class="toc-text">STM32F103 中断向量表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exti%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD"><span class="toc-number">3.2.</span> <span class="toc-text">EXTI 外部中断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stm32-exit%E6%A1%86%E6%9E%B6%E5%9B%BE"><span class="toc-number">3.3.</span> <span class="toc-text">STM32 EXIT 框架图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exti%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.</span> <span class="toc-text">EXTI 外部中断步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gpio%E5%BC%95%E8%84%9A%E9%85%8D%E7%BD%AE%E6%9C%AC%E6%96%87%E4%B8%AD%E5%92%8C%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%ADbsp_exith%E4%B8%80%E8%B5%B7%E8%BF%9B%E8%A1%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%AF%E4%BB%A5%E5%88%86%E5%BC%80%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-number">4.0.1.</span> <span class="toc-text">GPIO 引脚配置（本文中和外部中断 bsp_exit.h 一起进行初始化，可以分开进行配置相关函数）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%B5%8C%E5%A5%97%E5%90%91%E9%87%8F%E4%B8%AD%E6%96%AD%E6%8E%A7%E5%88%B6%E5%99%A8nvic%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.0.2.</span> <span class="toc-text">配置嵌套向量中断控制器 NVIC 步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-exti%E4%B8%AD%E6%96%AD%E5%8F%A3%E5%B9%B6%E8%AE%BE%E7%BD%AE%E4%B8%AD%E6%96%AD%E4%BC%98%E5%85%88%E7%BA%A7%E6%AD%A5%E9%AA%A4%E6%B5%81%E7%A8%8B"><span class="toc-number">4.0.3.</span> <span class="toc-text">配置 EXTI 中断口，并设置中断优先级步骤流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#gpio%E5%BC%95%E8%84%9A%E9%85%8D%E7%BD%AE"><span class="toc-number">4.0.3.1.</span> <span class="toc-text">GPIO 引脚配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E9%85%8D%E7%BD%AE"><span class="toc-number">4.0.3.2.</span> <span class="toc-text">中断配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bsp_exith"><span class="toc-number">4.1.</span> <span class="toc-text">BSP_EXIT.H</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bsp_exitc"><span class="toc-number">4.2.</span> <span class="toc-text">BSP_EXIT.C</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%B5%8C%E5%A5%97%E5%90%91%E9%87%8F%E4%B8%AD%E6%96%AD%E6%8E%A7%E5%88%B6%E5%99%A8nvic"><span class="toc-number">4.2.1.</span> <span class="toc-text">配置嵌套向量中断控制器 NVIC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-io%E4%B8%BAexti%E4%B8%AD%E6%96%AD%E5%8F%A3%E5%B9%B6%E8%AE%BE%E7%BD%AE%E4%B8%AD%E6%96%AD%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">4.2.2.</span> <span class="toc-text">配置 IO 为 EXTI 中断口，并设置中断优先级</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%AD%E6%9C%8D%E5%8A%A1%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.</span> <span class="toc-text">中断服务函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%89%E9%94%AE%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E6%B5%8B%E8%AF%95%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.1.</span> <span class="toc-text">按键外部中断测试函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mainc-2"><span class="toc-number">4.3.2.</span> <span class="toc-text">MAIN.C</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B2%E5%8F%A3%E6%89%93%E5%8D%B0%E6%95%88%E6%9E%9C"><span class="toc-number">4.4.</span> <span class="toc-text">串口打印效果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tft%E6%98%BE%E7%A4%BA%E6%95%88%E6%9E%9C"><span class="toc-number">4.5.</span> <span class="toc-text">TFT 显示效果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%9A%E5%AE%A2%E5%9C%B0%E5%9D%80httpsdelehubvercelapp"><span class="toc-number">4.6.</span> <span class="toc-text">博客地址 https:&#x2F;&#x2F;delehub.vercel.app&#x2F;</span></a></li></ol></li></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Do" data-src="/images/1.jpg"><p class="name" itemprop="name">Do</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">4</span> <span class="name">文章</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0pJRVNBTkc5MjQ0" title="https:&#x2F;&#x2F;github.com&#x2F;JIESANG9244"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTQxMzkxMjgyMA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;413912820"><i class="ic i-cloud-music"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2020/10/21/hello-world/" title="Hello World">Hello World</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2020/10/21/%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2020/10/21/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" title="个人博客">个人博客</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2020/10/22/STM32%E4%BE%8B/" title="STM32例">STM32例</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Do @ Dioy</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2020/10/22/STM32例/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.3"></script></body></html>